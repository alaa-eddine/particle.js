(function(){this.pjs=this.pjs||{};pjs.external=pjs.external||{};var b={angleVariance:"angleVar",blendFuncDestination:"textureAdditive",maxParticles:"totalParticles",particleLifespan:"life",particleLifespanVariance:"lifeVar",radialAccelVariance:"radialAccelVar",radialAcceleration:"radialAccel",speedVariance:"speedVar",startParticleSize:"startScale",endParticleSize:"endScale",tangentialAcceleration:"tangentialAccel",tangentialAccelVariance:"tangentialAccelVar"};pjs.external.Plistexternaler=function(d){this.rawPlist=d};function a(d){return d.childNodes[0].nodeValue}function c(d){return d.tagName}pjs.external.Plistexternaler.prototype={toParticleSystem:function(e){var d=this._parse(this.rawPlist);this._translate(d);e(d)},_translate:function(e){for(var f in b){var d=b[f];e[d]=e[f];delete e[f]}if(e.duration=-1){e.duration=Infinity}e.emissionRate=e.totalParticles/e.life;e.startScale=1;e.endScale=1;e.radius=10;e.radiusVar=0;e.textureAdditive=!!e.textureAdditive;e.textureEnabled=!!e.textureImageData;e.textureEnabled=false;e.active=true;e.pos={x:e.sourcePositionx,y:e.sourcePositiony};delete e.sourcePositionx;delete e.sourcePositiony;e.posVar={x:e.sourcePositionVariancex,y:e.sourcePositionVariancey};delete e.sourcePositionVariancex;delete e.sourcePositionVariancey;e.gravity={x:e.gravityx,y:e.gravityy};delete e.gravityx;delete e.gravityy;e.startColor=[e.startColorRed*255,e.startColorGreen*255,e.startColorBlue*255,e.startColorAlpha];delete e.startColorRed;delete e.startColorGreen;delete e.startColorBlue;delete e.startColorAlpha;e.startColorVar=[e.startColorVarianceRed*255,e.startColorVarianceGreen*255,e.startColorVarianceBlue*255,e.startColorVarianceAlpha];delete e.startColorVarianceRed;delete e.startColorVarianceGreen;delete e.startColorVarianceBlue;delete e.startColorVarianceAlpha;e.endColor=[e.finishColorRed*255,e.finishColorGreen*255,e.finishColorBlue*255,e.finishColorAlpha];delete e.finishColorRed;delete e.finishColorGreen;delete e.finishColorBlue;delete e.finishColorAlpha;e.endColorVar=[e.finishColorVarianceRed*255,e.finishColorVarianceGreen*255,e.finishColorVarianceBlue*255,e.finishColorVarianceAlpha];delete e.finishColorVarianceRed;delete e.finishColorVarianceGreen;delete e.finishColorVarianceBlue;delete e.finishColorVarianceAlpha},_loadTexture:function(e,f){var d=new Image();d.src="data:image/png;base64,"+e.textureImageData;d.onload=function(){e.texture=d;f(e)}},_parse:function(){var k=new DOMParser();var m=k.parseFromString(this.rawPlist,"text/xml");var p={};var o=m.getElementsByTagName("key");for(var g=0,e=o.length;g<e;++g){var d=o[g];var f=a(d);var n=o[g].nextElementSibling;var h=c(n);var j=a(n);if(h==="real"||h==="integer"){j=parseFloat(j)}p[f]=j}return p}}})();(function(){this.pjs=this.pjs||{};function a(b){var c=Math.sqrt(b.x*b.x+b.y*b.y);b.x/=c;b.y/=c}pjs.Emitter=function(b){if(!b){throw new Error("Must create an Emitter with a system")}this._currentSystem=b.name;this.reconfigure(b.system)};pjs.Emitter.prototype={overlay:function(b){pjs.extend(this,b);this.restart()},resetTexture:function(){this.overlay({texture:pjs.defaultTexture})},reconfigure:function(b){this._totalParticles=0;this.emissionRate=0;this.active=false;this.duration=Infinity;this.pos=this.pos||{};this.pos.x=0;this.pos.y=0;this.posVar=this.posVar||{};this.posVar.x=0;this.posVar.y=0;this.posVarTransformFn=null;this.angle=0;this.angleVar=0;this.life=0;this.lifeVar=0;this.radius=0;this.radiusVar=0;this.texture=null;this.textureEnabled=false;this.textureAdditive=false;this.startScale=0;this.startScaleVar=0;this.endScale=0;this.endScaleVar=0;this.startColor=this.startColor||[];this.startColor[0]=0;this.startColor[1]=0;this.startColor[2]=0;this.startColor[3]=0;this.startColorVar=this.startColorVar||[];this.startColorVar[0]=0;this.startColorVar[1]=0;this.startColorVar[2]=0;this.startColorVar[3]=0;this.endColor=this.endColor||[];this.endColor[0]=0;this.endColor[1]=0;this.endColor[2]=0;this.endColor[3]=0;this.endColorVar=this.endColorVar||[];this.endColorVar[0]=0;this.endColorVar[1]=0;this.endColorVar[2]=0;this.endColorVar[3]=0;this.gravity=this.gravity||{};this.gravity.x=0;this.gravity.y=0;this.radialAccel=0;this.radialAccelVar=0;this.tangentialAccel=0;this.tangentialAccelVar=0;pjs.recursiveExtend(this,b,["texture"]);this.restart()},restart:function(){this._particlePool=[];for(var b=0;b<this.totalParticles;++b){this._particlePool.push(new pjs.Particle())}this._particleCount=0;this._particleIndex=0;this._elapsed=0;this._emitCounter=0},reset:function(){var b=pjs.predefinedSystems.getSystem(this.currentSystem);this.reconfigure(b.system)},_isFull:function(){return this._particleCount===this.totalParticles},_addParticle:function(){if(this._isFull()){return false}var b=this._particlePool[this._particleCount];this._initParticle(b);++this._particleCount;return true},_initParticle:function(h){h.texture=this.texture;h.textureEnabled=this.textureEnabled;h.textureAdditive=this.textureAdditive;var b={x:this.posVar.x*pjs.random11(),y:this.posVar.y*pjs.random11()};if(this.posVarTransformFn){b=this.posVarTransformFn(b)}h.pos.x=this.pos.x+b.x;h.pos.y=this.pos.y+b.y;var g=this.angle+this.angleVar*pjs.random11();var e=this.speed+this.speedVar*pjs.random11();h.setVelocity(g,e);h.radialAccel=this.radialAccel+this.radialAccelVar*pjs.random11()||0;h.tangentialAccel=this.tangentialAccel+this.tangentialAccelVar*pjs.random11()||0;var d=this.life+this.lifeVar*pjs.random11()||0;h.life=Math.max(0,d);h.scale=pjs.isNumber(this.startScale)?this.startScale:1;h.deltaScale=pjs.isNumber(this.endScale)?(this.endScale-this.startScale):0;h.deltaScale/=h.life;h.radius=pjs.isNumber(this.radius)?this.radius+(this.radiusVar||0)*pjs.random11():0;if(this.startColor){var f=[this.startColor[0]+this.startColorVar[0]*pjs.random11(),this.startColor[1]+this.startColorVar[1]*pjs.random11(),this.startColor[2]+this.startColorVar[2]*pjs.random11(),this.startColor[3]+this.startColorVar[3]*pjs.random11()];var c=f;if(this.endColor){c=[this.endColor[0]+this.endColorVar[0]*pjs.random11(),this.endColor[1]+this.endColorVar[1]*pjs.random11(),this.endColor[2]+this.endColorVar[2]*pjs.random11(),this.endColor[3]+this.endColorVar[3]*pjs.random11()]}h.color=f;h.deltaColor=[(c[0]-f[0])/h.life,(c[1]-f[1])/h.life,(c[2]-f[2])/h.life,(c[3]-f[3])/h.life]}},_updateParticle:function(d,f,c){if(d.life>0){d.forces=d.forces||{x:0,y:0};d.forces.x=0;d.forces.y=0;d.radial=d.radial||{x:0,y:0};d.radial.x=0;d.radial.y=0;if((d.pos.x!==this.pos.x||d.pos.y!==this.pos.y)&&(d.radialAccel||d.tangentialAccel)){d.radial.x=d.pos.x-this.pos.x;d.radial.y=d.pos.y-this.pos.y;a(d.radial)}d.tangential=d.tangential||{x:0,y:0};d.tangential.x=d.radial.x;d.tangential.y=d.radial.y;d.radial.x*=d.radialAccel;d.radial.y*=d.radialAccel;var e=d.tangential.x;d.tangential.x=-d.tangential.y;d.tangential.y=e;d.tangential.x*=d.tangentialAccel;d.tangential.y*=d.tangentialAccel;d.forces.x=d.radial.x+d.tangential.x+this.gravity.x;d.forces.y=d.radial.y+d.tangential.y+this.gravity.y;d.forces.x*=f;d.forces.y*=f;d.vel.x+=d.forces.x;d.vel.y+=d.forces.y;d.pos.x+=d.vel.x*f;d.pos.y+=d.vel.y*f;d.life-=f;d.scale+=d.deltaScale*f;if(d.color){d.color[0]+=d.deltaColor[0]*f;d.color[1]+=d.deltaColor[1]*f;d.color[2]+=d.deltaColor[2]*f;d.color[3]+=d.deltaColor[3]*f}++this._particleIndex}else{var b=this._particlePool[c];this._particlePool[c]=this._particlePool[this._particleCount-1];this._particlePool[this._particleCount-1]=b;--this._particleCount}},update:function(d){if(!this.active){return}if(this.emissionRate){var b=1/this.emissionRate;this._emitCounter+=d;while(!this._isFull()&&this._emitCounter>b){this._addParticle();this._emitCounter-=b}}this._elapsed+=d;this.active=this._elapsed<this.duration;this._particleIndex=0;while(this._particleIndex<this._particleCount){var c=this._particlePool[this._particleIndex];this._updateParticle(c,d,this._particleIndex)}}};Object.defineProperty(pjs.Emitter.prototype,"particles",{get:function(){return this._particlePool}});Object.defineProperty(pjs.Emitter.prototype,"totalParticles",{get:function(){return this._totalParticles},set:function(b){b=b|0;if(b!==this._totalParticles){this._totalParticles=b;this.restart()}}});Object.defineProperty(pjs.Emitter.prototype,"currentSystem",{get:function(){return this._currentSystem},set:function(b){if(this._currentSystem!==b){this._currentSystem=b;var c=pjs.predefinedSystems.getSystem(b);this.reconfigure(c.system)}}});Object.defineProperty(pjs.Emitter.prototype,"transformFn",{get:function(){return this._transformFnSrc||""},set:function(c){this._transformFnSrc=c;try{this.posVarTransformFn=new Function("value",c)}catch(b){this.posVarTransformFn=null}}});Object.defineProperty(pjs.Emitter.prototype,"textureFile",{get:function(){return(this._file&&this._file.name)||""},set:function(b){try{pjs.TextureLoader.load(this,"texture",b);this._file=b}catch(c){}}});Object.defineProperty(pjs.Emitter.prototype,"plist",{get:function(){return this._plist||""},set:function(c){if(this._plist!==c){this._plist=c;var b=this;pjs.FileReader.readText(c,function(d){var e=new pjs.external.PlistImporter(d);e.toParticleSystem(function(f){b.reconfigure(f)})})}}})})();(function(){this.pjs=this.pjs||{};pjs.Particle=function(){this.pos={x:0,y:0};this.setVelocity(0,0);this.life=0};pjs.Particle.prototype={setVelocity:function(b,a){this.vel={x:Math.cos(pjs.toRad(b))*a,y:-Math.sin(pjs.toRad(b))*a}}}})();(function(){var a={center:function(b){return{x:(b.width/2)|0,y:(b.height/2)|0}},centerBottom:function(b){return{x:(b.width/2)|0,y:(b.height*2/3)|0}},centerOffBottom:function(b){return{x:(b.width/2)|0,y:b.height+20}},centerAboveTop:function(b){return{x:(b.width/2)|0,y:0}},bottomLeft:function(b){return{x:0,y:b.height+5}}};this.pjs=this.pjs||{};pjs.predefinedSystems={getSystem:function(b){var d=this.systems[0];for(var c=0;c<this.systems.length;++c){var e=this.systems[c];if(e.name===b){d=e;break}}return pjs.deepClone(d,["texture"])},positionSystems:function(c){for(var b=0;b<this.systems.length;++b){var d=this.systems[b].system.pos;this.systems[b].system.pos=a[d](c)}},setTexture:function(c){for(var b=0;b<this.systems.length;++b){this.systems[b].system.texture=c}},deleteSystem:function(d){var b;for(var c=0;c<this.systems.length;++c){if(this.systems[c].name===d){this.systems.splice(c,1);return}}},systems:[{name:"meteor",system:{totalParticles:150,emissionRate:150/2,pos:"center",gravity:{x:-200,y:-200},angle:90,angleVar:360,speed:15,speedVar:5,life:2,lifeVar:1,radialAccel:0,radialAccelVar:0,tangentialAccel:0,tangentialAccelVar:0,texture:pjs.defaultTexture,textureEnabled:true,textureAdditive:true,radius:12,radiusVar:2,startScale:1,endScale:1,startColor:[51,102,178.5,1],startColorVar:[0,0,51,0.1],endColor:[0,0,0,1],active:true,duration:Infinity}},{name:"fireworks",system:{totalParticles:1500,emissionRate:1500/3.5,pos:"centerBottom",angle:90,angleVar:20,gravity:{x:0,y:-90},speed:180,speedVar:50,life:3.5,lifeVar:1,radialAccel:0,radialAccelVar:0,tangentialAccel:0,tangentialAccelVar:0,radius:8,radiusVar:2,startScale:1,endScale:1,startColor:[127.5,127.5,127.5,1],startColorVar:[127.5,127.5,127.5,0],endColor:[25.5,25.5,25.5,0.2],endColorVar:[25.5,25.5,25.5,0.2],active:true,duration:Infinity}},{name:"fire",system:{totalParticles:250,emissionRate:250/7,pos:"centerBottom",posVar:{x:40,y:20},angle:90,angleVar:10,speed:60,speedVar:20,life:7,lifeVar:4,radialAccel:0,radialAccelVar:0,tangentialAccel:0,tangentialAccelVar:0,texture:pjs.defaultTexture,textureEnabled:true,textureAdditive:true,radius:10,radiusVar:1,startScale:1,endScale:1,startColor:[193.8,63.75,30.6,1],endColor:[0,0,0,0],active:true,duration:Infinity}},{name:"galaxy",system:{totalParticles:200,emissionRate:200/4,pos:"center",angle:90,angleVar:360,speed:60,speedVar:10,life:4,lifeVar:1,radialAccel:-80,radialAccelVar:0,tangentialAccel:80,tangentialAccelVar:0,texture:pjs.defaultTexture,textureEnabled:true,textureAdditive:true,radius:10,radiusVar:2,startScale:1,endScale:1,startColor:[30.6,63.75,193.8,1],endColor:[0,0,0,1],active:true,duration:Infinity}},{name:"snow",system:{totalParticles:700,emissionRate:10,pos:"centerAboveTop",posVar:{x:175,y:0},gravity:{x:0,y:8},angle:-90,angleVar:10,speed:9,speedVar:1,life:45,lifeVar:15,radialAccel:0,radialAccelVar:0,tangentialAccel:0,tangentialAccelVar:0,textureEnabled:false,textureAdditive:false,radius:3,radiusVar:2,startScale:1,endScale:0.3,startColor:[255,255,255,1],endColor:[255,255,255,0],active:true,duration:Infinity}},{name:"bubbles",system:{totalParticles:500,emissionRate:200,active:true,duration:Infinity,pos:"centerOffBottom",posVar:{x:150,y:0},angle:90,angleVar:20,life:3.5,lifeVar:1,radius:8,radiusVar:2,textureEnabled:false,textureAdditive:true,startScale:1,startScaleVar:0,endScale:1,endScaleVar:0,startColor:[198.9,198.9,255,1],startColorVar:[0,0,38,0.1],endColor:[25.5,25.5,25.5,0.2],endColorVar:[25.5,25.5,25.5,0.2],gravity:{x:0,y:-90},radialAccel:0,radialAccelVar:0,tangentialAccel:0,tangentialAccelVar:0,speed:180,speedVar:50}},{name:"watergeyser",system:{totalParticles:400,emissionRate:100,active:true,duration:Infinity,pos:"centerBottom",posVar:{x:0,y:0},angle:90,angleVar:10,life:2.5,lifeVar:1,radius:5,radiusVar:3,textureEnabled:false,textureAdditive:false,startScale:1,startScaleVar:0,endScale:1,endScaleVar:0,startColor:[19.89,59.93,255,1],startColorVar:[0,0,48,0.3],endColor:[198.9,198.9,255,0],endColorVar:[0,0,0,0],gravity:{x:0,y:150},radialAccel:0,radialAccelVar:0,tangentialAccel:0,tangentialAccelVar:0,speed:180,speedVar:50}},{name:"ribbon",system:{totalParticles:200,emissionRate:40,active:true,duration:Infinity,pos:"bottomLeft",posVar:{x:30,y:0},angle:55,angleVar:0,life:2.5,lifeVar:0,radius:10,radiusVar:5,textureEnabled:false,textureAdditive:false,startScale:1,startScaleVar:0,endScale:1,endScaleVar:0,startColor:[255,0,0,1],startColorVar:[0,0,0,0],endColor:[0,0,255,1],endColorVar:[0,0,0,0],gravity:{x:0,y:-45},radialAccel:0,radialAccelVar:0,tangentialAccel:60,tangentialAccelVar:0,speed:180,speedVar:50}},{name:"ringoffire",system:{totalParticles:400,emissionRate:180,active:true,duration:Infinity,pos:"center",posVar:{x:180,y:20},angle:90,angleVar:10,life:1,lifeVar:1,radius:10,radiusVar:1,textureEnabled:true,textureAdditive:true,startScale:1,startScaleVar:0,endScale:1,endScaleVar:0,startColor:[193.8,63.75,30.6,1],endColor:[0,0,0,0],gravity:{x:0,y:0},radialAccel:0,radialAccelVar:0,tangentialAccel:0,tangentialAccelVar:0,speed:60,speedVar:20}}]}})();(function(){this.pjs=this.pjs||{};var a={};function b(j,f){var i=j[0]|0;var h=j[1]|0;var d=j[2]|0;var e=f||j[3];return"rgba("+i+", "+h+", "+d+", "+e+")"}function c(f){var e=""+f.width+"x"+f.height;var d=a[e];if(!d){d=document.createElement("canvas");d.width=f.width;d.height=f.height;a[e]=d}return d}pjs.Renderer={_renderParticle:function(e,f){var d=b(f.color);e.fillStyle=d;e.beginPath();e.arc(f.pos.x,f.pos.y,f.radius*f.scale,0,Math.PI*2,true);e.closePath();e.fill()},_renderParticleTexture:function(g,k){k.buffer=k.buffer||c(k.texture);var f=k.buffer.getContext("2d");var e=(k.texture.width*k.scale)|0;var i=(k.texture.height*k.scale)|0;var d=k.pos.x-e/2;var j=k.pos.y-i/2;f.clearRect(0,0,k.buffer.width,k.buffer.height);f.globalAlpha=k.color[3];f.drawImage(k.texture,0,0);f.globalCompositeOperation="source-atop";f.fillStyle=b(k.color,1);f.fillRect(0,0,k.buffer.width,k.buffer.height);f.globalCompositeOperation="source-over";f.globalAlpha=1;g.drawImage(k.buffer,0,0,k.buffer.width,k.buffer.height,d,j,e,i)},render:function(e,f){for(var d=0;d<f.length;++d){var g=f[d];if(g.life>0&&g.color){if(g.textureAdditive){e.globalCompositeOperation="lighter"}else{e.globalCompositeOperation="source-over"}if(!g.texture||!g.textureEnabled){this._renderParticle(e,g)}else{this._renderParticleTexture(e,g)}}}e.globalCompositeOperation="source-over"}}})();(function(){this.pjs=this.pjs||{};this.pjs.TextureLoader={cache:{},load:function(c,b,a){if(this.cache[a.name]){this._overlay(c,b,this.cache[a.name])}else{this._loadViaFile(c,b,a)}},_overlay:function(c,b,a){if(a.width){c[b]=a}else{a.onload=function(){c[b]=a}}},_loadViaFile:function(e,d,b){if(!this._isImageFile(b)){throw new Error("this does not appear to be an image")}var c=this;var a=new FileReader();a.onload=function(f){var g=new Image();g.src=f.target.result;c.cache[b.name]=g;c._overlay(e,d,g)};a.onerror=function(){alert("failed to load the image file")};a.readAsDataURL(b)},_isImageFile:function(a){var b=a.name.indexOf(".");var c=a.name.substring(b+1);if(!c){return false}return["png","jpg","jpeg","gif"].indexOf(c.toLowerCase())>-1}}})();(function(){function a(b){return b===(b|0)}this.pjs=this.pjs||{};pjs.toRad=function(b){return Math.PI*b/180};pjs.random=function(d,g,h){h=h||false;var f=pjs.isNumber(g)?d:0;var c=pjs.isNumber(g)?g:d;var e=c-f;var b=Math.random()*e+f;if(a(f)&&a(c)&&!h){return Math.floor(b)}else{return b}};pjs.random11=function(){return pjs.random(-1,1,true)};pjs.extend=function(c,b){for(var d in b){if(b.hasOwnProperty(d)){c[d]=b[d]}}};pjs.recursiveExtend=function(d,b,c){for(var e in b){if(b.hasOwnProperty(e)){if(c.indexOf(e)>-1){d[e]=b[e]}else{if(typeof b[e]==="object"){pjs.recursiveExtend(d[e],b[e],c)}else{d[e]=b[e]}}}}};pjs.isNumber=function(b){return typeof b==="number"};pjs.clone=function(b){var c={};pjs.extend(c,b);return c};pjs.deepClone=function(e,c){if(typeof e!=="object"){return e}if(Array.isArray(e)){var d=[];for(var b=0;b<e.length;++b){d.push(pjs.deepClone(e[b],c))}return d}var g={};for(var f in e){if(c.indexOf(f)>-1){g[f]=e[f]}else{g[f]=pjs.deepClone(e[f],c)}}return g}})();(function(){var a="var r = pjs.toRad(value.x);\nreturn {\nx: Math.cos(r) * 70,\ny: Math.sin(r) * 70\n};";this.pjs=this.pjs||{};pjs.ui=pjs.ui||{};pjs.ui.Builder=function(d,g,f,c,b,e){this.containerId=d;this.particleSystem=g;this.canvas=f;this.controller=c;this.uiConfig=b&&pjs.ui.Parser.parse(b)||pjs.ui.FullConfig;this.includeTransformFn=e;this.build(e)};pjs.ui.Builder.prototype={build:function(e){var d=new dat.GUI({resizable:false,width:370});this.rootGui=d;this._addPlayButton(d);this._addResetButton(d);var c=this.uiConfig.length>1;for(var g=0;g<this.uiConfig.length;++g){var f=this.uiConfig[g];if(c){var h=d.addFolder(f.title||"Section")}else{h=d}for(var b=0;b<f.items.length;++b){this._addItem(h,f.items[b])}}if(e){this.particleSystem.transformFn=a;var j=d.addFolder("posVar Transform");j.addTextArea(this.particleSystem,"transformFn").name("function")}if(!c){this._openAllSubFolders()}},_openAllSubFolders:function(){for(var c in this.rootGui.__folders){if(this.rootGui.__folders.hasOwnProperty(c)){var b=this.rootGui.__folders[c];b.closed=false}}},_updateDisplays:function(b){for(var d in b.__folders){if(b.__folders.hasOwnProperty(d)){this._updateDisplays(b.__folders[d])}}for(var c=0;c<b.__controllers.length;++c){b.__controllers[c].updateDisplay()}},_addPlayButton:function(b){var e=b.add(this.controller,"togglePause").name(this.controller.isPaused()?"Play":"Pause");var d=this;e.__onChange=function(){e.name(d.controller.isPaused()?"Pause":"Play")}},_addResetButton:function(b){var e=b.add(this.particleSystem,"reset").name("Reset");var d=this;e.onChange(function(){setTimeout(function(){if(d.includeTransformFn){d.particleSystem.transformFn=a}d._updateDisplays(d.rootGui)},0)})},_addItem:function(b,d){var c=pjs.ui.PropertyMap[d];this["_"+c](b,d)},_boolean:function(b,c){b.add(this.particleSystem,c)},_color:function(b,d){var c=b.addFolder(d);c.add(this.particleSystem[d],"0").min(0).max(255).name("red");c.add(this.particleSystem[d],"1").min(0).max(255).name("green");c.add(this.particleSystem[d],"2").min(0).max(255).name("blue");c.add(this.particleSystem[d],"3").min(0).max(1).name("alpha")},_posvector:function(b,d){var c=b.addFolder(d);c.add(this.particleSystem[d],"x").min(0).max(this.canvas.width);c.add(this.particleSystem[d],"y").min(0).max(this.canvas.height)},_vector:function(b,d){var c=b.addFolder(d);c.add(this.particleSystem[d],"x").min(-500).max(500);c.add(this.particleSystem[d],"y").min(-500).max(500)},_number:function(b,c){return b.add(this.particleSystem,c).min(-500).max(500)},_unsignednumber:function(b,c){b.add(this.particleSystem,c).min(0).max(1000)},_systempicker:function(b){var e=[];for(var d=0;d<pjs.predefinedSystems.systems.length;++d){var g=pjs.predefinedSystems.systems[d];e.push(g.name)}var h=b.add(this.particleSystem,"currentSystem",e);var f=this;h.onChange(function(){f._updateDisplays(f.rootGui)})},_texture:function(b){b.addFile(this.particleSystem,"textureFile");b.add(this.particleSystem,"resetTexture")},_plistfile:function(b){b.addFile(this.particleSystem,"plist")}}})();(function(){this.pjs=this.pjs||{};this.pjs.ui=this.pjs.ui||{};this.pjs.ui.PropertyMap={pos:"posvector",posVar:"posvector",life:"unsignednumber",lifeVar:"unsignednumber",totalParticles:"unsignednumber",emissionRate:"unsignednumber",startColor:"color",startColorVar:"color",endColor:"color",endColorVar:"color",radius:"unsignednumber",radiusVar:"unsignednumber",texture:"texture",textureEnabled:"boolean",textureAdditive:"boolean",speed:"number",speedVar:"unsignednumber",angle:"number",angleVar:"unsignednumber",gravity:"vector",radialAccel:"number",radialAccelVar:"unsignednumber",tangentialAccel:"number",tangentialAccelVar:"unsignednumber",system:"systempicker",startScale:"unsignednumber",endScale:"unsignednumber",plist:"plistfile"};this.pjs.ui.FullConfig=[{title:"Predefined Systems",items:["system"]},{title:"Basics",items:["pos","posVar","life","lifeVar","totalParticles","emissionRate"]},{title:"Appearance",items:["startColor","startColorVar","endColor","endColorVar","radius","radiusVar"]},{title:"Texture",items:["texture","textureEnabled","textureAdditive"]},{title:"Physics",items:["speed","speedVar","angle","angleVar","gravity","radialAccel","radialAccelVar","tangentialAccel","tangentialAccelVar"]},{title:"Import/Export",items:["plist"]}]})();(function(){this.pjs=this.pjs||{};this.pjs.ui=this.pjs.ui||{};this.pjs.ui.Parser={parse:function(j){var c=[];if(j==="none"){return c}var e=j.split(":");for(var d=0,a=e.length;d<a;++d){var b=e[d];var g=b.split(",");var h={title:g.shift(),items:[]};for(var m=0;m<g.length;++m){var f=g[m];var k=f.split("=")[0];if(h.items.indexOf(k)<0){h.items.push(k)}}c.push(h)}return c}}})();(function(){this.pjs=this.pjs||{};var a=0;this.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame;if(!this.requestAnimationFrame){this.requestAnimationFrame=function(p,m){var l=new Date().getTime();var n=Math.max(0,16-(l-a));var o=window.setTimeout(function(){p(l+n)},n);a=l+n;return o}}function f(m){m=m.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var l="[\\?&]"+m+"=([^&#]*)";var o=new RegExp(l);var n=o.exec(window.location.href);return(n&&n[1])||""}function g(){var m=f("w");var l=f("h");return{width:+m||250,height:+l||300}}var j=true;var k=0;var i;var c;var b;var e;function d(p){e=new Stats();e.setMode(0);e.domElement.style.position="absolute";e.domElement.style.top=0;e.domElement.style.left=0;document.getElementById(p).appendChild(e.domElement);var m=["fpsGraph","msGraph"];for(var n=0;n<m.length;++n){var l=m[n];var o=document.getElementById(l);o.parentNode.removeChild(o)}}function h(l){if(j){return}e.begin();var m=l-(k||l);k=l;m/=1000;i.update(m);b.fillStyle="black";b.fillRect(0,0,b.canvas.width,b.canvas.height);pjs.Renderer.render(b,i.particles);requestAnimationFrame(h);e.end()}pjs.onReady=function(){pjs.defaultTexture=new Image();pjs.defaultTexture.src="particle.png";pjs.defaultTexture.onload=function(){c=document.createElement("canvas");var l=g();c.width=l.width;c.height=l.height;pjs.predefinedSystems.positionSystems(l);pjs.predefinedSystems.setTexture(pjs.defaultTexture);var n=pjs.predefinedSystems.getSystem(f("system"));pjs.ps=i=new pjs.Emitter(n);b=c.getContext("2d");var m=f("transform")==="true";if(!m){pjs.predefinedSystems.deleteSystem("ringoffire")}new pjs.ui.Builder("guiContainer",i,c,pjs,f("ui"),m);document.getElementById("canvasContainer").appendChild(c);d("canvasContainer");h(new Date().getTime())}};pjs.isPaused=function(){return j};pjs.togglePause=function(){j=!j;if(!j){k=0;h(new Date().getTime())}}})();var dat=dat||{};dat.gui=dat.gui||{};dat.utils=dat.utils||{};dat.controllers=dat.controllers||{};dat.dom=dat.dom||{};dat.color=dat.color||{};dat.utils.css=function(){return{load:function(c,b){var b=b||document,f=b.createElement("link");f.type="text/css";f.rel="stylesheet";f.href=c;b.getElementsByTagName("head")[0].appendChild(f)},inject:function(c,b){var b=b||document,f=document.createElement("style");f.type="text/css";f.innerHTML=c;b.getElementsByTagName("head")[0].appendChild(f)}}}();dat.utils.common=function(){var c=Array.prototype.forEach,b=Array.prototype.slice;return{BREAK:{},extend:function(a){this.each(b.call(arguments,1),function(d){for(var e in d){this.isUndefined(d[e])||(a[e]=d[e])}},this);return a},defaults:function(a){this.each(b.call(arguments,1),function(d){for(var e in d){this.isUndefined(a[e])&&(a[e]=d[e])}},this);return a},compose:function(){var a=b.call(arguments);return function(){for(var e=b.call(arguments),d=a.length-1;0<=d;d--){e=[a[d].apply(this,e)]}return e[0]}},each:function(e,i,f){if(c&&e.forEach===c){e.forEach(i,f)}else{if(e.length===e.length+0){for(var d=0,h=e.length;d<h&&!(d in e&&i.call(f,e[d],d)===this.BREAK);d++){}}else{for(d in e){if(i.call(f,e[d],d)===this.BREAK){break}}}}},defer:function(d){setTimeout(d,0)},toArray:function(a){return a.toArray?a.toArray():b.call(a)},isUndefined:function(d){return void 0===d},isNull:function(d){return null===d},isNaN:function(d){return d!==d},isArray:Array.isArray||function(d){return d.constructor===Array},isObject:function(d){return d===Object(d)},isNumber:function(d){return d===d+0},isString:function(d){return d===d+""},isBoolean:function(d){return !1===d||!0===d},isFunction:function(d){return"[object Function]"===Object.prototype.toString.call(d)}}}();dat.controllers.Controller=function(c){var b=function(d,e){this.initialValue=d[e];this.domElement=document.createElement("div");this.object=d;this.property=e;this.__onFinishChange=this.__onChange=void 0};c.extend(b.prototype,{onChange:function(d){this.__onChange=d;return this},onFinishChange:function(d){this.__onFinishChange=d;return this},setValue:function(d){this.object[this.property]=d;this.__onChange&&this.__onChange.call(this,d);this.updateDisplay();return this},getValue:function(){return this.object[this.property]},updateDisplay:function(){return this},isModified:function(){return this.initialValue!==this.getValue()}});return b}(dat.utils.common);dat.dom.dom=function(h){function b(a){if("0"===a||h.isUndefined(a)){return 0}a=a.match(j);return !h.isNull(a)?parseFloat(a[1]):0}var i={};h.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(c,d){h.each(c,function(a){i[a]=d})});var j=/(\d+(\.\d+)?)px/,f={makeSelectable:function(c,d){void 0===c||void 0===c.style||(c.onselectstart=d?function(){return !1}:function(){},c.style.MozUserSelect=d?"auto":"none",c.style.KhtmlUserSelect=d?"auto":"none",c.unselectable=d?"on":"off")},makeFullscreen:function(d,e,g){h.isUndefined(e)&&(e=!0);h.isUndefined(g)&&(g=!0);d.style.position="absolute";e&&(d.style.left=0,d.style.right=0);g&&(d.style.top=0,d.style.bottom=0)},fakeEvent:function(d,e,o,m){var o=o||{},n=i[e];if(!n){throw Error("Event type "+e+" not supported.")}var l=document.createEvent(n);switch(n){case"MouseEvents":l.initMouseEvent(e,o.bubbles||!1,o.cancelable||!0,window,o.clickCount||1,0,0,o.x||o.clientX||0,o.y||o.clientY||0,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":n=l.initKeyboardEvent||l.initKeyEvent;h.defaults(o,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0});n(e,o.bubbles||!1,o.cancelable,window,o.ctrlKey,o.altKey,o.shiftKey,o.metaKey,o.keyCode,o.charCode);break;default:l.initEvent(e,o.bubbles||!1,o.cancelable||!0)}h.defaults(l,m);d.dispatchEvent(l)},bind:function(e,g,l,k){e.addEventListener?e.addEventListener(g,l,k||!1):e.attachEvent&&e.attachEvent("on"+g,l);return f},unbind:function(e,g,l,k){e.removeEventListener?e.removeEventListener(g,l,k||!1):e.detachEvent&&e.detachEvent("on"+g,l);return f},addClass:function(d,e){if(void 0===d.className){d.className=e}else{if(d.className!==e){var g=d.className.split(/ +/);-1==g.indexOf(e)&&(g.push(e),d.className=g.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}}return f},removeClass:function(g,m){if(m){if(void 0!==g.className){if(g.className===m){g.removeAttribute("class")}else{var l=g.className.split(/ +/),k=l.indexOf(m);-1!=k&&(l.splice(k,1),g.className=l.join(" "))}}}else{g.className=void 0}return f},hasClass:function(d,e){return RegExp("(?:^|\\s+)"+e+"(?:\\s+|$)").test(d.className)||!1},getWidth:function(a){a=getComputedStyle(a);return b(a["border-left-width"])+b(a["border-right-width"])+b(a["padding-left"])+b(a["padding-right"])+b(a.width)},getHeight:function(a){a=getComputedStyle(a);return b(a["border-top-width"])+b(a["border-bottom-width"])+b(a["padding-top"])+b(a["padding-bottom"])+b(a.height)},getOffset:function(d){var e={left:0,top:0};if(d.offsetParent){do{e.left+=d.offsetLeft,e.top+=d.offsetTop}while(d=d.offsetParent)}return e},isActive:function(c){return c===document.activeElement&&(c.type||c.href)}};return f}(dat.utils.common);dat.controllers.OptionController=function(f,b,g){var h=function(j,a,k){h.superclass.call(this,j,a);var d=this;this.__select=document.createElement("select");if(g.isArray(k)){var c={};g.each(k,function(e){c[e]=e});k=c}g.each(k,function(i,e){var l=document.createElement("option");l.innerHTML=e;l.setAttribute("value",i);d.__select.appendChild(l)});this.updateDisplay();b.bind(this.__select,"change",function(){d.setValue(this.options[this.selectedIndex].value)});this.domElement.appendChild(this.__select)};h.superclass=f;g.extend(h.prototype,f.prototype,{setValue:function(c){c=h.superclass.prototype.setValue.call(this,c);this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue());return c},updateDisplay:function(){this.__select.value=this.getValue();return h.superclass.prototype.updateDisplay.call(this)}});return h}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);dat.controllers.NumberController=function(c,b){var f=function(e,d,a){f.superclass.call(this,e,d);a=a||{};this.__min=a.min;this.__max=a.max;this.__step=a.step;this.__impliedStep=b.isUndefined(this.__step)?0==this.initialValue?1:Math.pow(10,Math.floor(Math.log(this.initialValue)/Math.LN10))/10:this.__step;e=this.__impliedStep;e=e.toString();e=-1<e.indexOf(".")?e.length-e.indexOf(".")-1:0;this.__precision=e};f.superclass=c;b.extend(f.prototype,c.prototype,{setValue:function(d){void 0!==this.__min&&d<this.__min?d=this.__min:void 0!==this.__max&&d>this.__max&&(d=this.__max);void 0!==this.__step&&0!=d%this.__step&&(d=Math.round(d/this.__step)*this.__step);return f.superclass.prototype.setValue.call(this,d)},min:function(d){this.__min=d;return this},max:function(d){this.__max=d;return this},step:function(d){this.__step=d;return this}});return f}(dat.controllers.Controller,dat.utils.common);dat.controllers.NumberControllerBox=function(f,b,g){var h=function(n,a,q){function j(){var e=parseFloat(d.__input.value);g.isNaN(e)||d.setValue(e)}function c(i){var e=m-i.clientY;d.setValue(d.getValue()+e*d.__impliedStep);m=i.clientY}function o(){b.unbind(window,"mousemove",c);b.unbind(window,"mouseup",o)}this.__truncationSuspended=!1;h.superclass.call(this,n,a,q);var d=this,m;this.__input=document.createElement("input");this.__input.setAttribute("type","text");b.bind(this.__input,"change",j);b.bind(this.__input,"blur",function(){j();d.__onFinishChange&&d.__onFinishChange.call(d,d.getValue())});b.bind(this.__input,"mousedown",function(e){b.bind(window,"mousemove",c);b.bind(window,"mouseup",o);m=e.clientY});b.bind(this.__input,"keydown",function(e){13===e.keyCode&&(d.__truncationSuspended=!0,this.blur(),d.__truncationSuspended=!1)});this.updateDisplay();this.domElement.appendChild(this.__input)};h.superclass=f;g.extend(h.prototype,f.prototype,{updateDisplay:function(){var e=this.__input,c;if(this.__truncationSuspended){c=this.getValue()}else{c=this.getValue();var i=Math.pow(10,this.__precision);c=Math.round(c*i)/i}e.value=c;return h.superclass.prototype.updateDisplay.call(this)}});return h}(dat.controllers.NumberController,dat.dom.dom,dat.utils.common);dat.controllers.NumberControllerSlider=function(j,h,k,l,i){var f=function(t,r,n,p,b){function m(e){e.preventDefault();var q=h.getOffset(o.__background),g=h.getWidth(o.__background);o.setValue(o.__min+(o.__max-o.__min)*((e.clientX-q.left)/(q.left+g-q.left)));return !1}function a(){h.unbind(window,"mousemove",m);h.unbind(window,"mouseup",a);o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}f.superclass.call(this,t,r,{min:n,max:p,step:b});var o=this;this.__background=document.createElement("div");this.__foreground=document.createElement("div");h.bind(this.__background,"mousedown",function(c){h.bind(window,"mousemove",m);h.bind(window,"mouseup",a);m(c)});h.addClass(this.__background,"slider");h.addClass(this.__foreground,"slider-fg");this.updateDisplay();this.__background.appendChild(this.__foreground);this.domElement.appendChild(this.__background)};f.superclass=j;f.useDefaultStyles=function(){k.inject(i)};l.extend(f.prototype,j.prototype,{updateDisplay:function(){var b=(this.getValue()-this.__min)/(this.__max-this.__min);this.__foreground.style.width=100*b+"%";return f.superclass.prototype.updateDisplay.call(this)}});return f}(dat.controllers.NumberController,dat.dom.dom,dat.utils.css,dat.utils.common,"/**\n * dat-gui JavaScript Controller Library\n * http://code.google.com/p/dat-gui\n *\n * Copyright 2011 Data Arts Team, Google Creative Lab\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n */\n\n.slider {\n  box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);\n  height: 1em;\n  border-radius: 1em;\n  background-color: #eee;\n  padding: 0 0.5em;\n  overflow: hidden;\n}\n\n.slider-fg {\n  padding: 1px 0 2px 0;\n  background-color: #aaa;\n  height: 1em;\n  margin-left: -0.5em;\n  padding-right: 0.5em;\n  border-radius: 1em 0 0 1em;\n}\n\n.slider-fg:after {\n  display: inline-block;\n  border-radius: 1em;\n  background-color: #fff;\n  border:  1px solid #aaa;\n  content: '';\n  float: right;\n  margin-right: -1em;\n  margin-top: -1px;\n  height: 0.9em;\n  width: 0.9em;\n}");dat.controllers.FunctionController=function(f,b,g){var h=function(k,a,j){h.superclass.call(this,k,a);var c=this;this.__button=document.createElement("div");this.__button.innerHTML=void 0===j?"Fire":j;b.bind(this.__button,"click",function(d){d.preventDefault();c.fire();return !1});b.addClass(this.__button,"button");this.domElement.appendChild(this.__button)};h.superclass=f;g.extend(h.prototype,f.prototype,{fire:function(){this.__onChange&&this.__onChange.call(this);this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue());this.getValue().call(this.object)}});return h}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);dat.controllers.BooleanController=function(f,b,g){var h=function(i,a){h.superclass.call(this,i,a);var c=this;this.__prev=this.getValue();this.__checkbox=document.createElement("input");this.__checkbox.setAttribute("type","checkbox");b.bind(this.__checkbox,"change",function(){c.setValue(!c.__prev)},!1);this.domElement.appendChild(this.__checkbox);this.updateDisplay()};h.superclass=f;g.extend(h.prototype,f.prototype,{setValue:function(c){c=h.superclass.prototype.setValue.call(this,c);this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue());this.__prev=this.getValue();return c},updateDisplay:function(){!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0):this.__checkbox.checked=!1;return h.superclass.prototype.updateDisplay.call(this)}});return h}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);dat.color.toString=function(a){return function(b){if(1==b.a||a.isUndefined(b.a)){for(b=b.hex.toString(16);6>b.length;){b="0"+b}return"#"+b}return"rgba("+Math.round(b.r)+","+Math.round(b.g)+","+Math.round(b.b)+","+b.a+")"}}(dat.utils.common);dat.color.interpret=function(h,b){var i,j,f=[{litmus:b.isString,conversions:{THREE_CHAR_HEX:{read:function(c){c=c.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null===c?!1:{space:"HEX",hex:parseInt("0x"+c[1].toString()+c[1].toString()+c[2].toString()+c[2].toString()+c[3].toString()+c[3].toString())}},write:h},SIX_CHAR_HEX:{read:function(c){c=c.match(/^#([A-F0-9]{6})$/i);return null===c?!1:{space:"HEX",hex:parseInt("0x"+c[1].toString())}},write:h},CSS_RGB:{read:function(c){c=c.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null===c?!1:{space:"RGB",r:parseFloat(c[1]),g:parseFloat(c[2]),b:parseFloat(c[3])}},write:h},CSS_RGBA:{read:function(c){c=c.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/);return null===c?!1:{space:"RGB",r:parseFloat(c[1]),g:parseFloat(c[2]),b:parseFloat(c[3]),a:parseFloat(c[4])}},write:h}}},{litmus:b.isNumber,conversions:{HEX:{read:function(c){return{space:"HEX",hex:c,conversionName:"HEX"}},write:function(c){return c.hex}}}},{litmus:b.isArray,conversions:{RGB_ARRAY:{read:function(c){return 3!=c.length?!1:{space:"RGB",r:c[0],g:c[1],b:c[2]}},write:function(c){return[c.r,c.g,c.b]}},RGBA_ARRAY:{read:function(c){return 4!=c.length?!1:{space:"RGB",r:c[0],g:c[1],b:c[2],a:c[3]}},write:function(c){return[c.r,c.g,c.b,c.a]}}}},{litmus:b.isObject,conversions:{RGBA_OBJ:{read:function(a){return b.isNumber(a.r)&&b.isNumber(a.g)&&b.isNumber(a.b)&&b.isNumber(a.a)?{space:"RGB",r:a.r,g:a.g,b:a.b,a:a.a}:!1},write:function(c){return{r:c.r,g:c.g,b:c.b,a:c.a}}},RGB_OBJ:{read:function(a){return b.isNumber(a.r)&&b.isNumber(a.g)&&b.isNumber(a.b)?{space:"RGB",r:a.r,g:a.g,b:a.b}:!1},write:function(c){return{r:c.r,g:c.g,b:c.b}}},HSVA_OBJ:{read:function(a){return b.isNumber(a.h)&&b.isNumber(a.s)&&b.isNumber(a.v)&&b.isNumber(a.a)?{space:"HSV",h:a.h,s:a.s,v:a.v,a:a.a}:!1},write:function(c){return{h:c.h,s:c.s,v:c.v,a:c.a}}},HSV_OBJ:{read:function(a){return b.isNumber(a.h)&&b.isNumber(a.s)&&b.isNumber(a.v)?{space:"HSV",h:a.h,s:a.s,v:a.v}:!1},write:function(c){return{h:c.h,s:c.s,v:c.v}}}}}];return function(){j=!1;var a=1<arguments.length?b.toArray(arguments):arguments[0];b.each(f,function(c){if(c.litmus(a)){return b.each(c.conversions,function(k,d){i=k.read(a);if(!1===j&&!1!==i){return j=i,i.conversionName=d,i.conversion=k,b.BREAK}}),b.BREAK}});return j}}(dat.color.toString,dat.utils.common);dat.GUI=dat.gui.GUI=function(al,ap,am,an,ak,ao,ad,ai,af,ac,ag,W,Q,aa,u,aj,ah){function U(b,l,k,g){if(void 0===l[k]){throw Error("Object "+l+' has no property "'+k+'"')}g.color?l=new ag(l,k):g.textarea?l=new W(l,k):g.file?l=new Q(l,k):(l=[l,k].concat(g.factoryArgs),l=an.apply(b,l));g.before instanceof ak&&(g.before=g.before.__li);P(b,l);aj.addClass(l.domElement,"c");k=document.createElement("span");aj.addClass(k,"property-name");k.innerHTML=l.property;var j=document.createElement("div");j.appendChild(k);j.appendChild(l.domElement);var c=Y(b,j,g.before);aj.addClass(c,ae.CLASS_CONTROLLER_ROW);aj.addClass(c,typeof l.getValue());aj.addClass(c,l.additionalClasses);var i=l;i.__li=c;i.__gui=b;ah.extend(i,{options:function(a){if(1<arguments.length){return i.remove(),U(b,i.object,i.property,{before:i.__li.nextElementSibling,factoryArgs:[ah.toArray(arguments)]})}if(ah.isArray(a)||ah.isObject(a)){return i.remove(),U(b,i.object,i.property,{before:i.__li.nextElementSibling,factoryArgs:[a]})}},name:function(d){i.__li.firstElementChild.firstElementChild.innerHTML=d;return i},listen:function(){i.__gui.listen(i);return i},remove:function(){i.__gui.remove(i);return i}});if(i instanceof af){var h=new ai(i.object,i.property,{min:i.__min,max:i.__max,step:i.__step});ah.each(["updateDisplay","onChange","onFinishChange"],function(e){var m=i[e],d=h[e];i[e]=h[e]=function(){var n=Array.prototype.slice.call(arguments);m.apply(i,n);return d.apply(h,n)}});aj.addClass(c,"has-slider");i.domElement.insertBefore(h.domElement,i.domElement.firstElementChild)}else{i instanceof ai?(g=function(a){return ah.isNumber(i.__min)&&ah.isNumber(i.__max)?(i.remove(),U(b,i.object,i.property,{before:i.__li.nextElementSibling,factoryArgs:[i.__min,i.__max,i.__step]})):a},i.min=ah.compose(g,i.min),i.max=ah.compose(g,i.max)):i instanceof ao?(aj.bind(c,"click",function(){aj.fakeEvent(i.__checkbox,"click")}),aj.bind(i.__checkbox,"click",function(d){d.stopPropagation()})):i instanceof ad?(aj.bind(c,"click",function(){aj.fakeEvent(i.__button,"click")}),aj.bind(c,"mouseover",function(){aj.addClass(i.__button,"hover")}),aj.bind(c,"mouseout",function(){aj.removeClass(i.__button,"hover")})):i instanceof ag&&(aj.addClass(c,"color"),i.updateDisplay=ah.compose(function(d){c.style.borderLeftColor=i.__color.toString();return d},i.updateDisplay),i.updateDisplay())}i.setValue=ah.compose(function(a){b.getRoot().__preset_select&&i.isModified()&&T(b.getRoot(),!0);return a},i.setValue);b.__controllers.push(l);return l}function Y(g,i,e){var h=document.createElement("li");i&&h.appendChild(i);e?g.__ul.insertBefore(h,params.before):g.__ul.appendChild(h);g.onResize();return h}function P(h,k){var g=h.getRoot(),j=g.__rememberedObjects.indexOf(k.object);if(-1!=j){var i=g.__rememberedObjectIndecesToControllers[j];void 0===i&&(i={},g.__rememberedObjectIndecesToControllers[j]=i);i[k.property]=k;if(g.load&&g.load.remembered){g=g.load.remembered;if(g[h.preset]){g=g[h.preset]}else{if(g[ab]){g=g[ab]}else{return}}g[j]&&void 0!==g[j][k.property]&&(j=g[j][k.property],k.initialValue=j,k.setValue(j))}}}function S(b,d){b.domElement.style.width=d+"px";b.__save_row&&b.autoPlace&&(b.__save_row.style.width=d+"px");b.__closeButton&&(b.__closeButton.style.width=d+"px")}function X(e,g){var d={};ah.each(e.__rememberedObjects,function(c,b){var a={};ah.each(e.__rememberedObjectIndecesToControllers[b],function(i,h){a[h]=g?i.initialValue:i.getValue()});d[b]=a});return d}function R(g,i,e){var h=document.createElement("option");h.innerHTML=i;h.value=i;g.__preset_select.appendChild(h);e&&(g.__preset_select.selectedIndex=g.__preset_select.length-1)}function T(e,g){var d=e.__preset_select[e.__preset_select.selectedIndex];d.innerHTML=g?d.value+"*":d.value}function O(b){0!=b.length&&aa(function(){O(b)});ah.each(b,function(c){c.updateDisplay()})}al.inject(am);var ab="Default",N;try{N="localStorage" in window&&null!==window.localStorage}catch(f){N=!1}var Z,M=!0,v,V=!1,o=[],ae=function(y){function w(){localStorage.setItem(document.location.href+".gui",JSON.stringify(x.getSaveObject()))}var x=this;this.domElement=document.createElement("div");this.__ul=document.createElement("ul");this.domElement.appendChild(this.__ul);aj.addClass(this.domElement,"dg");this.__folders={};this.__controllers=[];this.__rememberedObjects=[];this.__rememberedObjectIndecesToControllers=[];this.__listening=[];y=y||{};y=ah.defaults(y,{autoPlace:!0,width:ae.DEFAULT_WIDTH});y=ah.defaults(y,{resizable:y.autoPlace,hideable:y.autoPlace});ah.isUndefined(y.load)?y.load={preset:ab}:y.preset&&(y.load.preset=y.preset);ah.isUndefined(y.parent)&&y.hideable&&o.push(this);y.resizable=ah.isUndefined(y.parent)&&y.resizable;y.autoPlace&&ah.isUndefined(y.scrollable)&&(y.scrollable=!0);var t=N&&"true"===localStorage.getItem(document.location.href+".isLocal");Object.defineProperties(this,{parent:{get:function(){return y.parent}},scrollable:{get:function(){return y.scrollable}},autoPlace:{get:function(){return y.autoPlace}},preset:{get:function(){return x.parent?x.getRoot().preset:y.load.preset},set:function(a){x.parent?x.getRoot().preset=a:y.load.preset=a;for(a=0;a<this.__preset_select.length;a++){this.__preset_select[a].value==this.preset&&(this.__preset_select.selectedIndex=a)}x.revert()}},width:{get:function(){return y.width},set:function(a){y.width=a;S(x,a)}},name:{get:function(){return y.name},set:function(a){y.name=a;q&&(q.innerHTML=y.name)}},closed:{get:function(){return y.closed},set:function(a){y.closed=a;y.closed?aj.addClass(x.__ul,ae.CLASS_CLOSED):aj.removeClass(x.__ul,ae.CLASS_CLOSED);this.onResize();x.__closeButton&&(x.__closeButton.innerHTML=a?ae.TEXT_OPEN:ae.TEXT_CLOSED)}},load:{get:function(){return y.load}},useLocalStorage:{get:function(){return t},set:function(b){N&&((t=b)?aj.bind(window,"unload",w):aj.unbind(window,"unload",w),localStorage.setItem(document.location.href+".isLocal",b))}}});if(ah.isUndefined(y.parent)){y.closed=!1;aj.addClass(this.domElement,ae.CLASS_MAIN);aj.makeSelectable(this.domElement,!1);if(N&&t){x.useLocalStorage=!0;var s=localStorage.getItem(document.location.href+".gui");s&&(y.load=JSON.parse(s))}this.__closeButton=document.createElement("div");this.__closeButton.innerHTML=ae.TEXT_CLOSED;aj.addClass(this.__closeButton,ae.CLASS_CLOSE_BUTTON);this.domElement.appendChild(this.__closeButton);aj.bind(this.__closeButton,"click",function(){x.closed=!x.closed})}else{void 0===y.closed&&(y.closed=!0);var q=document.createTextNode(y.name);aj.addClass(q,"controller-name");s=Y(x,q);aj.addClass(this.__ul,ae.CLASS_CLOSED);aj.addClass(s,"title");aj.bind(s,"click",function(b){b.preventDefault();x.closed=!x.closed;return !1});y.closed||(this.closed=!1)}y.autoPlace&&(ah.isUndefined(y.parent)&&(M&&(v=document.createElement("div"),aj.addClass(v,"dg"),aj.addClass(v,ae.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(v),M=!1),v.appendChild(this.domElement),aj.addClass(this.domElement,ae.CLASS_AUTO_PLACE)),this.parent||S(x,y.width));aj.bind(window,"resize",function(){x.onResize()});aj.bind(this.__ul,"webkitTransitionEnd",function(){x.onResize()});aj.bind(this.__ul,"transitionend",function(){x.onResize()});aj.bind(this.__ul,"oTransitionEnd",function(){x.onResize()});this.onResize();if(y.resizable){var r=this,s=function(b){b.preventDefault();j=b.clientX;aj.addClass(r.__closeButton,ae.CLASS_DRAG);aj.bind(window,"mousemove",m);aj.bind(window,"mouseup",h);return !1},m=function(b){b.preventDefault();r.width+=j-b.clientX;r.onResize();j=b.clientX;return !1},h=function(){aj.removeClass(r.__closeButton,ae.CLASS_DRAG);aj.unbind(window,"mousemove",m);aj.unbind(window,"mouseup",h)};r.__resize_handle=document.createElement("div");ah.extend(r.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});var j;aj.bind(r.__resize_handle,"mousedown",s);aj.bind(r.__closeButton,"mousedown",s);r.domElement.insertBefore(r.__resize_handle,r.domElement.firstElementChild)}x.getRoot();if(!y.parent){var n=x.getRoot();n.width+=1;ah.defer(function(){n.width-=1})}};ae.toggleHide=function(){V=!V;ah.each(o,function(b){b.domElement.style.zIndex=V?-999:999;b.domElement.style.opacity=V?0:1})};ae.CLASS_AUTO_PLACE="a";ae.CLASS_AUTO_PLACE_CONTAINER="ac";ae.CLASS_MAIN="main";ae.CLASS_CONTROLLER_ROW="cr";ae.CLASS_TOO_TALL="taller-than-window";ae.CLASS_CLOSED="closed";ae.CLASS_CLOSE_BUTTON="close-button";ae.CLASS_DRAG="drag";ae.DEFAULT_WIDTH=245;ae.TEXT_CLOSED="Close Controls";ae.TEXT_OPEN="Open Controls";aj.bind(window,"keydown",function(b){"text"!==document.activeElement.type&&("textarea"!==document.activeElement.type&&(72===b.which||72==b.keyCode))&&ae.toggleHide()},!1);ah.extend(ae.prototype,{add:function(d,c){return U(this,d,c,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(d,c){return U(this,d,c,{color:!0})},addTextArea:function(d,c){return U(this,d,c,{textarea:!0})},addFile:function(d,c){return U(this,d,c,{file:!0})},remove:function(d){this.__ul.removeChild(d.__li);this.__controllers.slice(this.__controllers.indexOf(d),1);var c=this;ah.defer(function(){c.onResize()})},destroy:function(){this.autoPlace&&v.removeChild(this.domElement)},addFolder:function(d){if(void 0!==this.__folders[d]){throw Error('You already have a folder in this GUI by the name "'+d+'"')}var c={name:d,parent:this};c.autoPlace=this.autoPlace;this.load&&(this.load.folders&&this.load.folders[d])&&(c.closed=this.load.folders[d].closed,c.load=this.load.folders[d]);c=new ae(c);this.__folders[d]=c;d=Y(this,c.domElement);aj.addClass(d,"folder");return c},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var e=this.getRoot();if(e.scrollable){var d=aj.getOffset(e.__ul).top,g=0;ah.each(e.__ul.childNodes,function(a){e.autoPlace&&a===e.__save_row||(g+=aj.getHeight(a))});window.innerHeight-d-20<g?(aj.addClass(e.domElement,ae.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-d-20+"px"):(aj.removeClass(e.domElement,ae.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&ah.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"});e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},remember:function(){ah.isUndefined(Z)&&(Z=new u,Z.domElement.innerHTML=ap);if(this.parent){throw Error("You can only call remember on a top level GUI.")}var a=this;ah.each(Array.prototype.slice.call(arguments),function(y){if(0==a.__rememberedObjects.length){var x=a,w=x.__save_row=document.createElement("li");aj.addClass(x.domElement,"has-save");x.__ul.insertBefore(w,x.__ul.firstChild);aj.addClass(w,"save-row");var t=document.createElement("span");t.innerHTML="&nbsp;";aj.addClass(t,"button gears");var r=document.createElement("span");r.innerHTML="Save";aj.addClass(r,"button");aj.addClass(r,"save");var s=document.createElement("span");s.innerHTML="New";aj.addClass(s,"button");aj.addClass(s,"save-as");var m=document.createElement("span");m.innerHTML="Revert";aj.addClass(m,"button");aj.addClass(m,"revert");var b=x.__preset_select=document.createElement("select");x.load&&x.load.remembered?ah.each(x.load.remembered,function(d,c){R(x,c,c==x.preset)}):R(x,ab,!1);aj.bind(b,"change",function(){for(var c=0;c<x.__preset_select.length;c++){x.__preset_select[c].innerHTML=x.__preset_select[c].value}x.preset=this.value});w.appendChild(b);w.appendChild(t);w.appendChild(r);w.appendChild(s);w.appendChild(m);if(N){var w=document.getElementById("dg-save-locally"),j=document.getElementById("dg-local-explain");w.style.display="block";w=document.getElementById("dg-local-storage");"true"===localStorage.getItem(document.location.href+".isLocal")&&w.setAttribute("checked","checked");var q=function(){j.style.display=x.useLocalStorage?"block":"none"};q();aj.bind(w,"change",function(){x.useLocalStorage=!x.useLocalStorage;q()})}var h=document.getElementById("dg-new-constructor");aj.bind(h,"keydown",function(c){c.metaKey&&(67===c.which||67==c.keyCode)&&Z.hide()});aj.bind(t,"click",function(){h.innerHTML=JSON.stringify(x.getSaveObject(),void 0,2);Z.show();h.focus();h.select()});aj.bind(r,"click",function(){x.save()});aj.bind(s,"click",function(){var c=prompt("Enter a new preset name.");c&&x.saveAs(c)});aj.bind(m,"click",function(){x.revert()})}-1==a.__rememberedObjects.indexOf(y)&&a.__rememberedObjects.push(y)});this.autoPlace&&S(this,this.width)},getRoot:function(){for(var b=this;b.parent;){b=b.parent}return b},getSaveObject:function(){var b=this.load;b.closed=this.closed;0<this.__rememberedObjects.length&&(b.preset=this.preset,b.remembered||(b.remembered={}),b.remembered[this.preset]=X(this));b.folders={};ah.each(this.__folders,function(a,d){b.folders[d]=a.getSaveObject()});return b},save:function(){this.load.remembered||(this.load.remembered={});this.load.remembered[this.preset]=X(this);T(this,!1)},saveAs:function(b){this.load.remembered||(this.load.remembered={},this.load.remembered[ab]=X(this,!0));this.load.remembered[b]=X(this);this.preset=b;R(this,b,!0)},revert:function(b){ah.each(this.__controllers,function(a){this.getRoot().load.remembered?P(b||this.getRoot(),a):a.setValue(a.initialValue)},this);ah.each(this.__folders,function(c){c.revert(c)});b||T(this.getRoot(),!1)},listen:function(d){var c=0==this.__listening.length;this.__listening.push(d);c&&O(this.__listening)}});return ae}(dat.utils.css,'<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n      \n    </div>\n    \n  </div>\n\n</div>',".dg {\n  /** Clear list styles */\n  /* Auto-place container */\n  /* Auto-placed GUI's */\n  /* Line items that don't contain folders. */\n  /** Folder names */\n  /** Hides closed items */\n  /** Controller row */\n  /** Name-half (left) */\n  /** Controller-half (right) */\n  /** Controller placement */\n  /** Shorter number boxes when slider is present. */\n  /** Ensure the entire boolean and function row shows a hand */ }\n  .dg ul {\n    list-style: none;\n    margin: 0;\n    padding: 0;\n    width: 100%;\n    clear: both; }\n  .dg:not(.ac) .main {\n    /** Exclude mains in ac so that we don't hide close button */\n    overflow: hidden; }\n  .dg.main {\n    -webkit-transition: opacity 0.1s linear;\n    -o-transition: opacity 0.1s linear;\n    -moz-transition: opacity 0.1s linear;\n    transition: opacity 0.1s linear; }\n    .dg.main.taller-than-window {\n      overflow-y: auto; }\n      .dg.main.taller-than-window .close-button {\n        opacity: 1;\n        /* TODO, these are style notes */\n        margin-top: -1px;\n        border-top: 1px solid #2c2c2c; }\n    .dg.main ul.closed .close-button {\n      opacity: 1 !important; }\n    .dg.main:hover .close-button,\n    .dg.main .close-button.drag {\n      opacity: 1; }\n    .dg.main .close-button {\n      /*opacity: 0;*/\n      -webkit-transition: opacity 0.1s linear;\n      -o-transition: opacity 0.1s linear;\n      -moz-transition: opacity 0.1s linear;\n      transition: opacity 0.1s linear;\n      border: 0;\n      position: absolute;\n      line-height: 19px;\n      height: 20px;\n      /* TODO, these are style notes */\n      cursor: pointer;\n      text-align: center;\n      background-color: #000; }\n      .dg.main .close-button:hover {\n        background-color: #111; }\n  .dg.a {\n    float: left;\n    overflow-x: hidden; }\n    .dg.a.has-save ul {\n      margin-top: 27px; }\n      .dg.a.has-save ul.closed {\n        margin-top: 0; }\n    .dg.a .save-row {\n      position: fixed;\n      top: 0;\n      z-index: 1002; }\n  .dg li {\n    -webkit-transition: height 0.1s ease-out;\n    -o-transition: height 0.1s ease-out;\n    -moz-transition: height 0.1s ease-out;\n    transition: height 0.1s ease-out; }\n  .dg li:not(.folder) {\n    cursor: auto;\n    height: 27px;\n    line-height: 27px;\n    overflow: hidden;\n    padding: 0 4px 0 5px; }\n  .dg li.textarea {\n    height: 100px; }\n  .dg li.folder {\n    padding: 0;\n    border-left: 4px solid rgba(0, 0, 0, 0); }\n  .dg li.title {\n    cursor: pointer;\n    margin-left: -4px; }\n  .dg .closed li:not(.title),\n  .dg .closed ul li,\n  .dg .closed ul li > * {\n    height: 0;\n    overflow: hidden;\n    border: 0; }\n  .dg .cr {\n    clear: both;\n    padding-left: 3px;\n    height: 27px; }\n  .dg .property-name {\n    cursor: default;\n    float: left;\n    clear: left;\n    width: 40%;\n    overflow: hidden;\n    text-overflow: ellipsis; }\n  .dg .c {\n    float: left;\n    width: 60%; }\n  .dg .c input[type=text] {\n    border: 0;\n    margin-top: 4px;\n    padding: 3px;\n    width: 100%;\n    float: right; }\n  .dg .has-slider input[type=text] {\n    width: 30%;\n    /*display: none;*/\n    margin-left: 0; }\n  .dg .slider {\n    float: left;\n    width: 66%;\n    margin-left: -5px;\n    margin-right: 0;\n    height: 19px;\n    margin-top: 4px; }\n  .dg .slider-fg {\n    height: 100%; }\n  .dg .c input[type=checkbox] {\n    margin-top: 9px; }\n  .dg .c select {\n    margin-top: 5px; }\n  .dg .cr.function,\n  .dg .cr.function .property-name,\n  .dg .cr.function *,\n  .dg .cr.boolean,\n  .dg .cr.boolean * {\n    cursor: pointer; }\n  .dg .selector {\n    display: none;\n    position: absolute;\n    margin-left: -9px;\n    margin-top: 23px;\n    z-index: 10; }\n  .dg .c:hover .selector,\n  .dg .selector.drag {\n    display: block; }\n  .dg li.save-row {\n    padding: 0; }\n    .dg li.save-row .button {\n      display: inline-block;\n      padding: 0px 6px; }\n  .dg.dialogue {\n    background-color: #222;\n    width: 460px;\n    padding: 15px;\n    font-size: 13px;\n    line-height: 15px; }\n\n/* TODO Separate style and structure */\n#dg-new-constructor {\n  padding: 10px;\n  color: #222;\n  font-family: Monaco, monospace;\n  font-size: 10px;\n  border: 0;\n  resize: none;\n  box-shadow: inset 1px 1px 1px #888;\n  word-wrap: break-word;\n  margin: 12px 0;\n  display: block;\n  width: 440px;\n  overflow-y: scroll;\n  height: 100px;\n  position: relative; }\n\n#dg-local-explain {\n  display: none;\n  font-size: 11px;\n  line-height: 17px;\n  border-radius: 3px;\n  background-color: #333;\n  padding: 8px;\n  margin-top: 10px; }\n  #dg-local-explain code {\n    font-size: 10px; }\n\n#dat-gui-save-locally {\n  display: none; }\n\n/** Main type */\n.dg {\n  color: #eee;\n  font: 11px 'Lucida Grande', sans-serif;\n  text-shadow: 0 -1px 0 #111111;\n  /** Auto place */\n  /* Controller row, <li> */\n  /** Controllers */ }\n  .dg.main {\n    /** Scrollbar */ }\n    .dg.main::-webkit-scrollbar {\n      width: 5px;\n      background: #1a1a1a; }\n    .dg.main::-webkit-scrollbar-corner {\n      height: 0;\n      display: none; }\n    .dg.main::-webkit-scrollbar-thumb {\n      border-radius: 5px;\n      background: #676767; }\n  .dg li:not(.folder) {\n    background: #1a1a1a;\n    border-bottom: 1px solid #2c2c2c; }\n  .dg li.save-row {\n    line-height: 25px;\n    background: #dad5cb;\n    border: 0; }\n    .dg li.save-row select {\n      margin-left: 5px;\n      width: 108px; }\n    .dg li.save-row .button {\n      margin-left: 5px;\n      margin-top: 1px;\n      border-radius: 2px;\n      font-size: 9px;\n      line-height: 7px;\n      padding: 4px 4px 5px 4px;\n      background: #c5bdad;\n      color: #fff;\n      text-shadow: 0 1px 0 #b0a58f;\n      box-shadow: 0 -1px 0 #b0a58f;\n      cursor: pointer; }\n      .dg li.save-row .button.gears {\n        background: #c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;\n        height: 7px;\n        width: 8px; }\n      .dg li.save-row .button:hover {\n        background-color: #bab19e;\n        box-shadow: 0 -1px 0 #b0a58f; }\n  .dg li.folder {\n    border-bottom: 0; }\n  .dg li.title {\n    padding-left: 16px;\n    background: black url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;\n    cursor: pointer;\n    border-bottom: 1px solid rgba(255, 255, 255, 0.2); }\n  .dg .closed li.title {\n    background-image: url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==); }\n  .dg .cr.boolean {\n    border-left: 3px solid #806787; }\n  .dg .cr.function {\n    border-left: 3px solid #e61d5f; }\n  .dg .cr.number {\n    border-left: 3px solid #2fa1d6; }\n    .dg .cr.number input[type=text] {\n      color: #2fa1d6; }\n  .dg .cr.string {\n    border-left: 3px solid #1ed36f; }\n    .dg .cr.string input[type=text], .dg .cr.string textarea {\n      color: #1ed36f; }\n  .dg .cr.function:hover, .dg .cr.boolean:hover {\n    background: #111; }\n  .dg .c input[type=text], .dg .c textarea {\n    background: #303030;\n    outline: none; }\n    .dg .c input[type=text]:hover, .dg .c textarea:hover {\n      background: #3c3c3c; }\n    .dg .c input[type=text]:focus, .dg .c textarea:focus {\n      background: #494949;\n      color: #fff; }\n  .dg .c .slider {\n    background: #303030;\n    cursor: ew-resize; }\n  .dg .c .slider-fg {\n    background: #2fa1d6; }\n  .dg .c .slider:hover {\n    background: #3c3c3c; }\n    .dg .c .slider:hover .slider-fg {\n      background: #44abda; }\n",dat.controllers.factory=function(j,h,k,m,i,f,l){return function(c,a,e,b){var d=c[a];if(l.isArray(e)||l.isObject(e)){return new j(c,a,e)}if(l.isNumber(d)){return l.isNumber(e)&&l.isNumber(b)?new k(c,a,e,b):new h(c,a,{min:e,max:b})}if(l.isString(d)){return new m(c,a)}if(l.isFunction(d)){return new i(c,a,"")}if(l.isBoolean(d)){return new f(c,a)}}}(dat.controllers.OptionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.StringController=function(f,b,g){var h=function(k,a){function j(){c.setValue(c.__input.value)}h.superclass.call(this,k,a);var c=this;this.__input=document.createElement("input");this.__input.setAttribute("type","text");b.bind(this.__input,"keyup",j);b.bind(this.__input,"change",j);b.bind(this.__input,"blur",function(){c.__onFinishChange&&c.__onFinishChange.call(c,c.getValue())});b.bind(this.__input,"keydown",function(d){13===d.keyCode&&this.blur()});this.updateDisplay();this.domElement.appendChild(this.__input)};h.superclass=f;g.extend(h.prototype,f.prototype,{updateDisplay:function(){b.isActive(this.__input)||(this.__input.value=this.getValue());return h.superclass.prototype.updateDisplay.call(this)}});return h}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.controllers.FunctionController,dat.controllers.BooleanController,dat.utils.common),dat.controllers.Controller,dat.controllers.BooleanController,dat.controllers.FunctionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.OptionController,dat.controllers.ColorController=function(l,h,m,p,k){function f(g,e,n,i){g.style.background="";k.each(j,function(a){g.style.cssText+="background: "+a+"linear-gradient("+e+", "+n+" 0%, "+i+" 100%); "})}var o=function(u,c){function d(e){v(e);h.bind(window,"mousemove",v);h.bind(window,"mouseup",n)}function n(){h.unbind(window,"mousemove",v);h.unbind(window,"mouseup",n)}function x(){var e=p(this.value);!1!==e?(g.__color.__state=e,g.setValue(g.__color.toOriginal())):this.value=g.__color.toString()}function b(){h.unbind(window,"mousemove",s);h.unbind(window,"mouseup",b)}function v(i){i.preventDefault();var t=h.getWidth(g.__saturation_field),r=h.getOffset(g.__saturation_field),q=(i.clientX-r.left+document.body.scrollLeft)/t,i=1-(i.clientY-r.top+document.body.scrollTop)/t;1<i?i=1:0>i&&(i=0);1<q?q=1:0>q&&(q=0);g.__color.v=i;g.__color.s=q;g.setValue(g.__color.toOriginal());return !1}function s(e){e.preventDefault();var q=h.getHeight(g.__hue_field),i=h.getOffset(g.__hue_field),e=1-(e.clientY-i.top+document.body.scrollTop)/q;1<e?e=1:0>e&&(e=0);g.__color.h=360*e;g.setValue(g.__color.toOriginal());return !1}o.superclass.call(this,u,c);this.__color=new m(this.getValue());this.__temp=new m(0);var g=this;this.domElement=document.createElement("div");h.makeSelectable(this.domElement,!1);this.__selector=document.createElement("div");this.__selector.className="selector";this.__saturation_field=document.createElement("div");this.__saturation_field.className="saturation-field";this.__field_knob=document.createElement("div");this.__field_knob.className="field-knob";this.__field_knob_border="2px solid ";this.__hue_knob=document.createElement("div");this.__hue_knob.className="hue-knob";this.__hue_field=document.createElement("div");this.__hue_field.className="hue-field";this.__input=document.createElement("input");this.__input.type="text";this.__input_textShadow="0 1px 1px ";h.bind(this.__input,"keydown",function(e){13===e.keyCode&&x.call(this)});h.bind(this.__input,"blur",x);h.bind(this.__selector,"mousedown",function(){h.addClass(this,"drag").bind(window,"mouseup",function(){h.removeClass(g.__selector,"drag")})});var y=document.createElement("div");k.extend(this.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"});k.extend(this.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:this.__field_knob_border+(0.5>this.__color.v?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1});k.extend(this.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1});k.extend(this.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"});k.extend(y.style,{width:"100%",height:"100%",background:"none"});f(y,"top","rgba(0,0,0,0)","#000");k.extend(this.__hue_field.style,{width:"15px",height:"100px",display:"inline-block",border:"1px solid #555",cursor:"ns-resize"});var a=this.__hue_field;a.style.background="";a.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);";a.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";a.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";a.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";a.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";k.extend(this.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:this.__input_textShadow+"rgba(0,0,0,0.7)"});h.bind(this.__saturation_field,"mousedown",d);h.bind(this.__field_knob,"mousedown",d);h.bind(this.__hue_field,"mousedown",function(e){s(e);h.bind(window,"mousemove",s);h.bind(window,"mouseup",b)});this.__saturation_field.appendChild(y);this.__selector.appendChild(this.__field_knob);this.__selector.appendChild(this.__saturation_field);this.__selector.appendChild(this.__hue_field);this.__hue_field.appendChild(this.__hue_knob);this.domElement.appendChild(this.__input);this.domElement.appendChild(this.__selector);this.updateDisplay()};o.superclass=l;k.extend(o.prototype,l.prototype,{updateDisplay:function(){var b=p(this.getValue());if(!1!==b){var g=!1;k.each(m.COMPONENTS,function(a){if(!k.isUndefined(b[a])&&!k.isUndefined(this.__color.__state[a])&&b[a]!==this.__color.__state[a]){return g=!0,{}}},this);g&&k.extend(this.__color.__state,b)}k.extend(this.__temp.__state,this.__color.__state);this.__temp.a=1;var c=0.5>this.__color.v||0.5<this.__color.s?255:0,d=255-c;k.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toString(),border:this.__field_knob_border+"rgb("+c+","+c+","+c+")"});this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px";this.__temp.s=1;this.__temp.v=1;f(this.__saturation_field,"left","#fff",this.__temp.toString());k.extend(this.__input.style,{backgroundColor:this.__input.value=this.__color.toString(),color:"rgb("+c+","+c+","+c+")",textShadow:this.__input_textShadow+"rgba("+d+","+d+","+d+",.7)"})}});var j=["-moz-","-o-","-webkit-","-ms-",""];return o}(dat.controllers.Controller,dat.dom.dom,dat.color.Color=function(m,r,o,p){function k(e,d,g){Object.defineProperty(e,d,{get:function(){if("RGB"===this.__state.space){return this.__state[d]}f(this,d,g);return this.__state[d]},set:function(b){"RGB"!==this.__state.space&&(f(this,d,g),this.__state.space="RGB");this.__state[d]=b}})}function q(d,c){Object.defineProperty(d,c,{get:function(){if("HSV"===this.__state.space){return this.__state[c]}j(this);return this.__state[c]},set:function(b){"HSV"!==this.__state.space&&(j(this),this.__state.space="HSV");this.__state[c]=b}})}function f(a,g,c){if("HEX"===a.__state.space){a.__state[g]=r.component_from_hex(a.__state.hex,c)}else{if("HSV"===a.__state.space){p.extend(a.__state,r.hsv_to_rgb(a.__state.h,a.__state.s,a.__state.v))}else{throw"Corrupted color state"}}}function j(a){var c=r.rgb_to_hsv(a.r,a.g,a.b);p.extend(a.__state,{s:c.s,v:c.v});p.isNaN(c.h)?p.isUndefined(a.__state.h)&&(a.__state.h=0):a.__state.h=c.h}var h=function(){this.__state=m.apply(this,arguments);if(!1===this.__state){throw"Failed to interpret color arguments"}this.__state.a=this.__state.a||1};h.COMPONENTS="r g b h s v hex a".split(" ");p.extend(h.prototype,{toString:function(){return o(this)},toOriginal:function(){return this.__state.conversion.write(this)}});k(h.prototype,"r",2);k(h.prototype,"g",1);k(h.prototype,"b",0);q(h.prototype,"h");q(h.prototype,"s");q(h.prototype,"v");Object.defineProperty(h.prototype,"a",{get:function(){return this.__state.a},set:function(b){this.__state.a=b}});Object.defineProperty(h.prototype,"hex",{get:function(){"HEX"!==!this.__state.space&&(this.__state.hex=r.rgb_to_hex(this.r,this.g,this.b));return this.__state.hex},set:function(b){this.__state.space="HEX";this.__state.hex=b}});return h}(dat.color.interpret,dat.color.math=function(){var a;return{hsv_to_rgb:function(g,i,k){var h=g/60-Math.floor(g/60),f=k*(1-i),j=k*(1-h*i),i=k*(1-(1-h)*i),g=[[k,i,f],[j,k,f],[f,k,i],[f,j,k],[i,f,k],[k,f,j]][Math.floor(g/60)%6];return{r:255*g[0],g:255*g[1],b:255*g[2]}},rgb_to_hsv:function(g,i,j){var h=Math.min(g,i,j),f=Math.max(g,i,j),h=f-h;if(0==f){return{h:NaN,s:0,v:0}}g=(g==f?(i-j)/h:i==f?2+(j-g)/h:4+(g-i)/h)/6;0>g&&(g+=1);return{h:360*g,s:h/f,v:f/255}},rgb_to_hex:function(b,e,f){b=this.hex_with_component(0,2,b);b=this.hex_with_component(b,1,e);return b=this.hex_with_component(b,0,f)},component_from_hex:function(b,c){return b>>8*c&255},hex_with_component:function(b,e,f){return f<<(a=8*e)|b&~(255<<a)}}}(),dat.color.toString,dat.utils.common),dat.color.interpret,dat.utils.common),dat.controllers.TextAreaController=function(f,b,g){var h=function(k,a){function j(){c.setValue(c.__textarea.value)}h.superclass.call(this,k,a);var c=this;this.__textarea=document.createElement("textarea");this.__textarea.setAttribute("rows",5);this.__textarea.setAttribute("cols",18);b.bind(this.__textarea,"keyup",j);b.bind(this.__textarea,"change",j);b.bind(this.__textarea,"blur",function(){c.__onFinishChange&&c.__onFinishChange.call(c,c.getValue())});this.updateDisplay();this.domElement.appendChild(this.__textarea);this.additionalClasses="textarea"};h.superclass=f;g.extend(h.prototype,f.prototype,{updateDisplay:function(){b.isActive(this.__textarea)||(this.__textarea.value=this.getValue());return h.superclass.prototype.updateDisplay.call(this)}});return h}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.controllers.FileController=function(f,b,g){var h=function(i,a){h.superclass.call(this,i,a);var c=this;this.__input=document.createElement("input");this.__input.setAttribute("type","file");b.bind(this.__input,"change",function(){c.setValue(c.__input.files[0])});this.updateDisplay();this.domElement.appendChild(this.__input)};h.superclass=f;g.extend(h.prototype,f.prototype);return h}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.utils.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1000/60)}}(),dat.dom.CenteredDiv=function(c,b){var f=function(){this.backgroundElement=document.createElement("div");b.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear"});c.makeFullscreen(this.backgroundElement);this.backgroundElement.style.position="fixed";this.domElement=document.createElement("div");b.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear"});document.body.appendChild(this.backgroundElement);document.body.appendChild(this.domElement);var a=this;c.bind(this.backgroundElement,"click",function(){a.hide()})};f.prototype.show=function(){var a=this;this.backgroundElement.style.display="block";this.domElement.style.display="block";this.domElement.style.opacity=0;this.domElement.style.webkitTransform="scale(1.1)";this.layout();b.defer(function(){a.backgroundElement.style.opacity=1;a.domElement.style.opacity=1;a.domElement.style.webkitTransform="scale(1)"})};f.prototype.hide=function(){var e=this,g=function(){e.domElement.style.display="none";e.backgroundElement.style.display="none";c.unbind(e.domElement,"webkitTransitionEnd",g);c.unbind(e.domElement,"transitionend",g);c.unbind(e.domElement,"oTransitionEnd",g)};c.bind(this.domElement,"webkitTransitionEnd",g);c.bind(this.domElement,"transitionend",g);c.bind(this.domElement,"oTransitionEnd",g);this.backgroundElement.style.opacity=0;this.domElement.style.opacity=0;this.domElement.style.webkitTransform="scale(1.1)"};f.prototype.layout=function(){this.domElement.style.left=window.innerWidth/2-c.getWidth(this.domElement)/2+"px";this.domElement.style.top=window.innerHeight/2-c.getHeight(this.domElement)/2+"px"};return f}(dat.dom.dom,dat.utils.common),dat.dom.dom,dat.utils.common);var Stats=function(){var B=Date.now(),A=B,G=0,z=Infinity,y=0,F=0,x=Infinity,w=0,v=0,u=0,H=document.createElement("div");H.id="stats";H.addEventListener("mousedown",function(a){a.preventDefault();b(++u%2)},!1);H.style.cssText="width:80px;opacity:0.9;cursor:pointer";var L=document.createElement("div");L.id="fps";L.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002";H.appendChild(L);var E=document.createElement("div");E.id="fpsText";E.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px";E.innerHTML="FPS";L.appendChild(E);var K=document.createElement("div");K.id="fpsGraph";K.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff";for(L.appendChild(K);74>K.children.length;){var D=document.createElement("span");D.style.cssText="width:1px;height:30px;float:left;background-color:#113";K.appendChild(D)}var J=document.createElement("div");J.id="ms";J.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none";H.appendChild(J);var C=document.createElement("div");C.id="msText";C.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px";C.innerHTML="MS";J.appendChild(C);var I=document.createElement("div");I.id="msGraph";I.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0";for(J.appendChild(I);74>I.children.length;){D=document.createElement("span"),D.style.cssText="width:1px;height:30px;float:left;background-color:#131",I.appendChild(D)}var b=function(a){u=a;switch(u){case 0:L.style.display="block";J.style.display="none";break;case 1:L.style.display="none",J.style.display="block"}};return{REVISION:11,domElement:H,setMode:b,begin:function(){B=Date.now()},end:function(){var c=Date.now();G=c-B;z=Math.min(z,G);y=Math.max(y,G);C.textContent=G+" MS ("+z+"-"+y+")";var d=Math.min(30,30-30*(G/200));I.appendChild(I.firstChild).style.height=d+"px";v++;c>A+1000&&(F=Math.round(1000*v/(c-A)),x=Math.min(x,F),w=Math.max(w,F),E.textContent=F+" FPS ("+x+"-"+w+")",d=Math.min(30,30-30*(F/100)),K.appendChild(K.firstChild).style.height=d+"px",A=c,v=0);return c},update:function(){B=this.end()}}};