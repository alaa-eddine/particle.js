(function(){this.pjs=this.pjs||{};function a(b){var c=Math.sqrt(b.x*b.x+b.y*b.y);b.x/=c;b.y/=c}pjs.Emitter=function(b){if(!b){throw new Error("Must create an Emitter with a system")}this._currentSystem=b.name;this.reconfigure(b.system)};pjs.Emitter.prototype={overlay:function(b){pjs.extend(this,b);this.restart()},resetTexture:function(){this.overlay({texture:pjs.defaultTexture})},reconfigure:function(b){this._totalParticles=0;this.emissionRate=0;this.active=false;this.duration=Infinity;this.pos=this.pos||{};this.pos.x=0;this.pos.y=0;this.posVar=this.posVar||{};this.posVar.x=0;this.posVar.y=0;this.posVarTransformFn=null;this.angle=0;this.angleVar=0;this.life=0;this.lifeVar=0;this.radius=0;this.radiusVar=0;this.texture=null;this.textureEnabled=false;this.textureAdditive=false;this.startScale=0;this.startScaleVar=0;this.endScale=0;this.endScaleVar=0;this.startColor=this.startColor||[];this.startColor[0]=0;this.startColor[1]=0;this.startColor[2]=0;this.startColor[3]=0;this.startColorVar=this.startColorVar||[];this.startColorVar[0]=0;this.startColorVar[1]=0;this.startColorVar[2]=0;this.startColorVar[3]=0;this.endColor=this.endColor||[];this.endColor[0]=0;this.endColor[1]=0;this.endColor[2]=0;this.endColor[3]=0;this.endColorVar=this.endColorVar||[];this.endColorVar[0]=0;this.endColorVar[1]=0;this.endColorVar[2]=0;this.endColorVar[3]=0;this.gravity=this.gravity||{};this.gravity.x=0;this.gravity.y=0;this.radialAccel=0;this.radialAccelVar=0;this.tangentialAccel=0;this.tangentialAccelVar=0;pjs.recursiveExtend(this,b,["texture"]);this.restart()},restart:function(){this._particlePool=[];for(var b=0;b<this.totalParticles;++b){this._particlePool.push(new pjs.Particle())}this._particleCount=0;this._particleIndex=0;this._elapsed=0;this._emitCounter=0},reset:function(){var b=pjs.predefinedSystems.getSystem(this.currentSystem);this.reconfigure(b.system)},_isFull:function(){return this._particleCount===this.totalParticles},_addParticle:function(){if(this._isFull()){return false}var b=this._particlePool[this._particleCount];this._initParticle(b);++this._particleCount;return true},_initParticle:function(h){h.texture=this.texture;h.textureEnabled=this.textureEnabled;h.textureAdditive=this.textureAdditive;var b={x:this.posVar.x*pjs.random11(),y:this.posVar.y*pjs.random11()};if(this.posVarTransformFn){b=this.posVarTransformFn(b)}h.pos.x=this.pos.x+b.x;h.pos.y=this.pos.y+b.y;var g=this.angle+this.angleVar*pjs.random11();var e=this.speed+this.speedVar*pjs.random11();h.setVelocity(g,e);h.radialAccel=this.radialAccel+this.radialAccelVar*pjs.random11()||0;h.tangentialAccel=this.tangentialAccel+this.tangentialAccelVar*pjs.random11()||0;var d=this.life+this.lifeVar*pjs.random11()||0;h.life=Math.max(0,d);h.scale=pjs.isNumber(this.startScale)?this.startScale:1;h.deltaScale=pjs.isNumber(this.endScale)?(this.endScale-this.startScale):0;h.deltaScale/=h.life;h.radius=pjs.isNumber(this.radius)?this.radius+(this.radiusVar||0)*pjs.random11():0;if(this.startColor){var f=[this.startColor[0]+this.startColorVar[0]*pjs.random11(),this.startColor[1]+this.startColorVar[1]*pjs.random11(),this.startColor[2]+this.startColorVar[2]*pjs.random11(),this.startColor[3]+this.startColorVar[3]*pjs.random11()];var c=f;if(this.endColor){c=[this.endColor[0]+this.endColorVar[0]*pjs.random11(),this.endColor[1]+this.endColorVar[1]*pjs.random11(),this.endColor[2]+this.endColorVar[2]*pjs.random11(),this.endColor[3]+this.endColorVar[3]*pjs.random11()]}h.color=f;h.deltaColor=[(c[0]-f[0])/h.life,(c[1]-f[1])/h.life,(c[2]-f[2])/h.life,(c[3]-f[3])/h.life]}},_updateParticle:function(d,f,c){if(d.life>0){d.forces=d.forces||{x:0,y:0};d.forces.x=0;d.forces.y=0;d.radial=d.radial||{x:0,y:0};d.radial.x=0;d.radial.y=0;if((d.pos.x!==this.pos.x||d.pos.y!==this.pos.y)&&(d.radialAccel||d.tangentialAccel)){d.radial.x=d.pos.x-this.pos.x;d.radial.y=d.pos.y-this.pos.y;a(d.radial)}d.tangential=d.tangential||{x:0,y:0};d.tangential.x=d.radial.x;d.tangential.y=d.radial.y;d.radial.x*=d.radialAccel;d.radial.y*=d.radialAccel;var e=d.tangential.x;d.tangential.x=-d.tangential.y;d.tangential.y=e;d.tangential.x*=d.tangentialAccel;d.tangential.y*=d.tangentialAccel;d.forces.x=d.radial.x+d.tangential.x+this.gravity.x;d.forces.y=d.radial.y+d.tangential.y+this.gravity.y;d.forces.x*=f;d.forces.y*=f;d.vel.x+=d.forces.x;d.vel.y+=d.forces.y;d.pos.x+=d.vel.x*f;d.pos.y+=d.vel.y*f;d.life-=f;d.scale+=d.deltaScale*f;if(d.color){d.color[0]+=d.deltaColor[0]*f;d.color[1]+=d.deltaColor[1]*f;d.color[2]+=d.deltaColor[2]*f;d.color[3]+=d.deltaColor[3]*f}++this._particleIndex}else{var b=this._particlePool[c];this._particlePool[c]=this._particlePool[this._particleCount-1];this._particlePool[this._particleCount-1]=b;--this._particleCount}},_updateFrameRate:function(c){++this.frames;this.fpsElapsed+=c;if(this.fpsElapsed>2&&this.fpsContainer){var b=this.frames/this.fpsElapsed;b=Math.round(b*100)/100;this.fpsContainer.innerHTML=b+" fps";this.fpsElapsed=0;this.frames=0}},update:function(d){if(!this.active){return}this._updateFrameRate(d);if(this.emissionRate){var b=1/this.emissionRate;this._emitCounter+=d;while(!this._isFull()&&this._emitCounter>b){this._addParticle();this._emitCounter-=b}}this._elapsed+=d;this.active=this._elapsed<this.duration;this._particleIndex=0;while(this._particleIndex<this._particleCount){var c=this._particlePool[this._particleIndex];this._updateParticle(c,d,this._particleIndex)}},setFpsContainer:function(b){this.fpsContainer=b;this.frames=0;this.fpsElapsed=0}};Object.defineProperty(pjs.Emitter.prototype,"particles",{get:function(){return this._particlePool}});Object.defineProperty(pjs.Emitter.prototype,"totalParticles",{get:function(){return this._totalParticles},set:function(b){b=b|0;if(b!==this._totalParticles){this._totalParticles=b;this.restart()}}});Object.defineProperty(pjs.Emitter.prototype,"currentSystem",{get:function(){return this._currentSystem},set:function(b){if(this._currentSystem!==b){this._currentSystem=b;var c=pjs.predefinedSystems.getSystem(b);this.reconfigure(c.system)}}})})();(function(){this.pjs=this.pjs||{};pjs.Particle=function(){this.pos={x:0,y:0};this.setVelocity(0,0);this.life=0};pjs.Particle.prototype={setVelocity:function(b,a){this.vel={x:Math.cos(pjs.toRad(b))*a,y:-Math.sin(pjs.toRad(b))*a}}}})();(function(){var a={center:function(b){return{x:(b.width/2)|0,y:(b.height/2)|0}},centerBottom:function(b){return{x:(b.width/2)|0,y:(b.height*2/3)|0}},centerOffBottom:function(b){return{x:(b.width/2)|0,y:b.height+20}},centerAboveTop:function(b){return{x:(b.width/2)|0,y:0}},bottomLeft:function(b){return{x:0,y:b.height+5}}};this.pjs=this.pjs||{};pjs.predefinedSystems={getSystem:function(b){var d=this.systems[0];for(var c=0;c<this.systems.length;++c){var e=this.systems[c];if(e.name===b){d=e;break}}return pjs.deepClone(d,["texture"])},positionSystems:function(c){for(var b=0;b<this.systems.length;++b){var d=this.systems[b].system.pos;this.systems[b].system.pos=a[d](c)}},setTexture:function(c){for(var b=0;b<this.systems.length;++b){this.systems[b].system.texture=c}},deleteSystem:function(d){var b;for(var c=0;c<this.systems.length;++c){if(this.systems[c].name===d){this.systems.splice(c,1);return}}},systems:[{name:"meteor",system:{totalParticles:150,emissionRate:150/2,pos:"center",gravity:{x:-200,y:-200},angle:90,angleVar:360,speed:15,speedVar:5,life:2,lifeVar:1,radialAccel:0,radialAccelVar:0,tangentialAccel:0,tangentialAccelVar:0,texture:pjs.defaultTexture,textureEnabled:true,textureAdditive:true,radius:12,radiusVar:2,startScale:1,endScale:1,startColor:[51,102,178.5,1],startColorVar:[0,0,51,0.1],endColor:[0,0,0,1],active:true,duration:Infinity}},{name:"fireworks",system:{totalParticles:1500,emissionRate:1500/3.5,pos:"centerBottom",angle:90,angleVar:20,gravity:{x:0,y:-90},speed:180,speedVar:50,life:3.5,lifeVar:1,radialAccel:0,radialAccelVar:0,tangentialAccel:0,tangentialAccelVar:0,radius:8,radiusVar:2,startScale:1,endScale:1,startColor:[127.5,127.5,127.5,1],startColorVar:[127.5,127.5,127.5,0],endColor:[25.5,25.5,25.5,0.2],endColorVar:[25.5,25.5,25.5,0.2],active:true,duration:Infinity}},{name:"fire",system:{totalParticles:250,emissionRate:250/7,pos:"centerBottom",posVar:{x:40,y:20},angle:90,angleVar:10,speed:60,speedVar:20,life:7,lifeVar:4,radialAccel:0,radialAccelVar:0,tangentialAccel:0,tangentialAccelVar:0,texture:pjs.defaultTexture,textureEnabled:true,textureAdditive:true,radius:10,radiusVar:1,startScale:1,endScale:1,startColor:[193.8,63.75,30.6,1],endColor:[0,0,0,0],active:true,duration:Infinity}},{name:"galaxy",system:{totalParticles:200,emissionRate:200/4,pos:"center",angle:90,angleVar:360,speed:60,speedVar:10,life:4,lifeVar:1,radialAccel:-80,radialAccelVar:0,tangentialAccel:80,tangentialAccelVar:0,texture:pjs.defaultTexture,textureEnabled:true,textureAdditive:true,radius:10,radiusVar:2,startScale:1,endScale:1,startColor:[30.6,63.75,193.8,1],endColor:[0,0,0,1],active:true,duration:Infinity}},{name:"snow",system:{totalParticles:700,emissionRate:10,pos:"centerAboveTop",posVar:{x:175,y:0},gravity:{x:0,y:8},angle:-90,angleVar:10,speed:9,speedVar:1,life:45,lifeVar:15,radialAccel:0,radialAccelVar:0,tangentialAccel:0,tangentialAccelVar:0,textureEnabled:false,textureAdditive:false,radius:3,radiusVar:2,startScale:1,endScale:0.3,startColor:[255,255,255,1],endColor:[255,255,255,0],active:true,duration:Infinity}},{name:"bubbles",system:{totalParticles:500,emissionRate:200,active:true,duration:Infinity,pos:"centerOffBottom",posVar:{x:150,y:0},angle:90,angleVar:20,life:3.5,lifeVar:1,radius:8,radiusVar:2,textureEnabled:false,textureAdditive:true,startScale:1,startScaleVar:0,endScale:1,endScaleVar:0,startColor:[198.9,198.9,255,1],startColorVar:[0,0,38,0.1],endColor:[25.5,25.5,25.5,0.2],endColorVar:[25.5,25.5,25.5,0.2],gravity:{x:0,y:-90},radialAccel:0,radialAccelVar:0,tangentialAccel:0,tangentialAccelVar:0,speed:180,speedVar:50}},{name:"watergeyser",system:{totalParticles:400,emissionRate:100,active:true,duration:Infinity,pos:"centerBottom",posVar:{x:0,y:0},angle:90,angleVar:10,life:2.5,lifeVar:1,radius:5,radiusVar:3,textureEnabled:false,textureAdditive:false,startScale:1,startScaleVar:0,endScale:1,endScaleVar:0,startColor:[19.89,59.93,255,1],startColorVar:[0,0,48,0.3],endColor:[198.9,198.9,255,0],endColorVar:[0,0,0,0],gravity:{x:0,y:150},radialAccel:0,radialAccelVar:0,tangentialAccel:0,tangentialAccelVar:0,speed:180,speedVar:50}},{name:"ribbon",system:{totalParticles:200,emissionRate:40,active:true,duration:Infinity,pos:"bottomLeft",posVar:{x:30,y:0},angle:55,angleVar:0,life:2.5,lifeVar:0,radius:10,radiusVar:5,textureEnabled:false,textureAdditive:false,startScale:1,startScaleVar:0,endScale:1,endScaleVar:0,startColor:[255,0,0,1],startColorVar:[0,0,0,0],endColor:[0,0,255,1],endColorVar:[0,0,0,0],gravity:{x:0,y:-45},radialAccel:0,radialAccelVar:0,tangentialAccel:60,tangentialAccelVar:0,speed:180,speedVar:50}},{name:"ringoffire",system:{totalParticles:400,emissionRate:180,active:true,duration:Infinity,pos:"center",posVar:{x:180,y:20},angle:90,angleVar:10,life:1,lifeVar:1,radius:10,radiusVar:1,textureEnabled:true,textureAdditive:true,startScale:1,startScaleVar:0,endScale:1,endScaleVar:0,startColor:[193.8,63.75,30.6,1],endColor:[0,0,0,0],gravity:{x:0,y:0},radialAccel:0,radialAccelVar:0,tangentialAccel:0,tangentialAccelVar:0,speed:60,speedVar:20}}]}})();(function(){this.pjs=this.pjs||{};function a(i,e){var h=i[0]|0;var f=i[1]|0;var c=i[2]|0;var d=e||i[3];return"rgba("+h+", "+f+", "+c+", "+d+")"}function b(d){var c=document.createElement("canvas");c.width=d.width;c.height=d.height;return c}pjs.Renderer={_renderParticle:function(d,e){var c=a(e.color);d.fillStyle=c;d.beginPath();d.arc(e.pos.x,e.pos.y,e.radius*e.scale,0,Math.PI*2,true);d.closePath();d.fill()},_renderParticleTexture:function(f,j){j.buffer=j.buffer||b(j.texture);var e=j.buffer.getContext("2d");var d=(j.texture.width*j.scale)|0;var g=(j.texture.height*j.scale)|0;var c=j.pos.x-d/2;var i=j.pos.y-g/2;e.clearRect(0,0,j.buffer.width,j.buffer.height);e.globalAlpha=j.color[3];e.drawImage(j.texture,0,0);e.globalCompositeOperation="source-atop";e.fillStyle=a(j.color,1);e.fillRect(0,0,j.buffer.width,j.buffer.height);e.globalCompositeOperation="source-over";e.globalAlpha=1;f.drawImage(j.buffer,0,0,j.buffer.width,j.buffer.height,c,i,d,g)},render:function(d,e){for(var c=0;c<e.length;++c){var f=e[c];if(f.life>0&&f.color){if(f.textureAdditive){d.globalCompositeOperation="lighter"}else{d.globalCompositeOperation="source-over"}if(!f.texture||!f.textureEnabled){this._renderParticle(d,f)}else{this._renderParticleTexture(d,f)}}}d.globalCompositeOperation="source-over"}}})();(function(){function a(b){return b===(b|0)}this.pjs=this.pjs||{};pjs.toRad=function(b){return Math.PI*b/180};pjs.random=function(d,g,h){h=h||false;var f=pjs.isNumber(g)?d:0;var c=pjs.isNumber(g)?g:d;var e=c-f;var b=Math.random()*e+f;if(a(f)&&a(c)&&!h){return Math.floor(b)}else{return b}};pjs.random11=function(){return pjs.random(-1,1,true)};pjs.extend=function(c,b){for(var d in b){if(b.hasOwnProperty(d)){c[d]=b[d]}}};pjs.recursiveExtend=function(d,b,c){for(var e in b){if(b.hasOwnProperty(e)){if(c.indexOf(e)>-1){d[e]=b[e]}else{if(typeof b[e]==="object"){pjs.recursiveExtend(d[e],b[e],c)}else{d[e]=b[e]}}}}};pjs.isNumber=function(b){return typeof b==="number"};pjs.clone=function(b){var c={};pjs.extend(c,b);return c};pjs.deepClone=function(e,c){if(typeof e!=="object"){return e}if(Array.isArray(e)){var d=[];for(var b=0;b<e.length;++b){d.push(pjs.deepClone(e[b],c))}return d}var g={};for(var f in e){if(c.indexOf(f)>-1){g[f]=e[f]}else{g[f]=pjs.deepClone(e[f],c)}}return g}})();(function(){this.pjs=this.pjs||{};pjs.ui=pjs.ui||{};pjs.ui.Builder=function(c,f,e,b,a,d){this.containerId=c;this.particleSystem=f;this.canvas=e;this.controller=b;this.uiConfig=a&&pjs.ui.Parser.parse(a)||pjs.ui.FullConfig;this.includeTransformFn=d;if(this.uiConfig.length){this.build()}};pjs.ui.Builder.prototype={build:function(){var c=new dat.GUI();document.getElementById(this.containerId).appendChild(c.domElement);var b=this.uiConfig.length>1;for(var e=0;e<this.uiConfig.length;++e){var d=this.uiConfig[e];if(b){var f=c.addFolder(d.title||"Section")}else{f=c}for(var a=0;a<d.items.length;++a){this._addItem(f,d.items[a])}}this._addPlayButton(c);this._addResetButton(c);this._listenForAllControllers(c)},_listenForAllControllers:function(a){for(var c in a.__folders){if(a.__folders.hasOwnProperty(c)){this._listenForAllControllers(a.__folders[c])}}for(var b=0;b<a.__controllers.length;++b){a.__controllers[b].listen()}},_addPlayButton:function(a){var d=a.add(this.controller,"togglePause").name(this.controller.isPaused()?"Play":"Pause");var b=this;d.__onChange=function(){d.name(b.controller.isPaused()?"Pause":"Play")}},_addResetButton:function(a){a.add(this.particleSystem,"reset").name("Reset")},_addItem:function(a,b){this["_"+b.type](a,b.property)},_boolean:function(a,b){a.add(this.particleSystem,b)},_color:function(a,c){var b=a.addFolder(c);b.addColor(this.particleSystem,c).name("color");b.add(this.particleSystem[c],"3").min(0).max(1).name("alpha")},_colorvar:function(a,c){var b=a.addFolder(c);b.add(this.particleSystem[c],"0").min(0).max(255).name("red");b.add(this.particleSystem[c],"1").min(0).max(255).name("green");b.add(this.particleSystem[c],"2").min(0).max(255).name("blue");b.add(this.particleSystem[c],"3").min(0).max(1).name("alpha")},_posvector:function(a,c){var b=a.addFolder(c);b.add(this.particleSystem[c],"x").min(0).max(this.canvas.width);b.add(this.particleSystem[c],"y").min(0).max(this.canvas.height)},_vector:function(a,c){var b=a.addFolder(c);b.add(this.particleSystem[c],"x").min(-500).max(500);b.add(this.particleSystem[c],"y").min(-500).max(500)},_number:function(a,b){return a.add(this.particleSystem,b).min(-500).max(500)},_unsignednumber:function(a,b){a.add(this.particleSystem,b).min(0).max(1000)},_systempicker:function(a){var c=[];for(var b=0;b<pjs.predefinedSystems.systems.length;++b){var d=pjs.predefinedSystems.systems[b];c.push(d.name)}a.add(this.particleSystem,"currentSystem",c)},_texturereset:function(a){a.add(this.particleSystem,"resetTexture").name("reset texture")},_texture:function(){}}})();(function(){this.pjs=this.pjs||{};this.pjs.ui=this.pjs.ui||{};this.pjs.ui.FullConfig=[{title:"Predefined Systems",items:[{type:"systempicker"}]},{title:"Basics",items:[{type:"posvector",property:"pos"},{type:"posvector",property:"posVar"},{type:"unsignednumber",property:"life"},{type:"unsignednumber",property:"lifeVar"},{type:"unsignednumber",property:"totalParticles"},{type:"unsignednumber",property:"emissionRate"}]},{title:"Appearance",items:[{type:"color",property:"startColor"},{type:"colorvar",property:"startColorVar"},{type:"color",property:"endColor"},{type:"colorvar",property:"endColorVar"},{type:"unsignednumber",property:"radius"},{type:"unsignednumber",property:"radiusVar"}]},{title:"Texture",items:[{type:"texture",property:"texture"},{type:"boolean",property:"textureEnabled"},{type:"boolean",property:"textureAdditive"},{type:"texturereset",property:"texture"}]},{title:"Physics",items:[{type:"number",property:"speed"},{type:"unsignednumber",property:"speedVar"},{type:"number",property:"angle"},{type:"unsignednumber",property:"angleVar"},{type:"vector",property:"gravity"},{type:"number",property:"radialAccel"},{type:"unsignednumber",property:"radialAccelVar"},{type:"number",property:"tangentialAccel"},{type:"unsignednumber",property:"tangentialAccelVar"}]}]})();(function(){this.pjs=this.pjs||{};this.pjs.ui=this.pjs.ui||{};this.pjs.ui.Parser={parse:function(k){var c=[];if(k==="none"){return c}var e=k.split(":");for(var d=0,a=e.length;d<a;++d){var b=e[d];var g=b.split(",");var j={title:g.shift(),items:[]};for(var m=0;m<g.length;++m){var f=g[m];var h=f.split("=");j.items.push({property:h[0],type:h[1]})}c.push(j)}return c}}})();(function(){this.pjs=this.pjs||{};this.pjs.ui=this.pjs.ui||{};this.pjs.ui.TextureLoader={load:function(c,b,a){if(this.cache[a.name]){this._overlay(c,b,this.cache[a.name])}else{this._loadViaFile(c,b,a)}},_overlay:function(d,c,a){var b={};b[c]=a;d.overlay(b)},_loadViaFile:function(e,d,b){if(!this._isImageFile(b)){alert("this does not appear to be an image");return}var c=this;var a=new FileReader();a.onload=function(f){var g=new Image();g.src=f.target.result;c.cache[b.name]=g;c._overlay(e,d,g)};a.onerror=function(){alert("failed to load the image file")};a.readAsDataURL(b)},_isImageFile:function(a){var b=a.name.indexOf(".");var c=a.name.substring(b+1);if(!c){return false}return["png","jpg","jpeg","gif"].indexOf(extenstion.toLowerCase())>-1}}})();(function(){this.pjs=this.pjs||{};var a=0;this.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame;if(!this.requestAnimationFrame){this.requestAnimationFrame=function(p,m){var l=new Date().getTime();var n=Math.max(0,16-(l-a));var o=window.setTimeout(function(){p(l+n)},n);a=l+n;return o}}function f(m){m=m.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var l="[\\?&]"+m+"=([^&#]*)";var o=new RegExp(l);var n=o.exec(window.location.href);return(n&&n[1])||""}function g(){var m=f("w");var l=f("h");return{width:+m||250,height:+l||300}}var j=false;var k=0;var i;var c;var b;var e;function d(p){e=new Stats();e.setMode(0);e.domElement.style.position="absolute";e.domElement.style.top=0;e.domElement.style.left=0;document.getElementById(p).appendChild(e.domElement);var m=["fpsGraph","msGraph"];for(var n=0;n<m.length;++n){var l=m[n];var o=document.getElementById(l);o.parentNode.removeChild(o)}}function h(l){if(j){return}e.begin();var m=l-(k||l);k=l;m/=1000;i.update(m);b.fillStyle="black";b.fillRect(0,0,b.canvas.width,b.canvas.height);pjs.Renderer.render(b,i.particles);requestAnimationFrame(h);e.end()}pjs.onReady=function(){pjs.defaultTexture=new Image();pjs.defaultTexture.src="particle.png";pjs.defaultTexture.onload=function(){c=document.createElement("canvas");var l=g();c.width=l.width;c.height=l.height;pjs.predefinedSystems.positionSystems(l);pjs.predefinedSystems.setTexture(pjs.defaultTexture);var n=pjs.predefinedSystems.getSystem(f("system"));pjs.ps=i=new pjs.Emitter(n);b=c.getContext("2d");var m=f("transform")==="true";if(!m){pjs.predefinedSystems.deleteSystem("ringoffire")}new pjs.ui.Builder("guiContainer",i,c,pjs,f("ui"),m);document.getElementById("canvasContainer").appendChild(c);d("canvasContainer");h(new Date().getTime())}};pjs.isPaused=function(){return j};pjs.togglePause=function(){j=!j;if(!j){k=0;h(new Date().getTime())}}})();var dat=dat||{};dat.gui=dat.gui||{};dat.utils=dat.utils||{};dat.controllers=dat.controllers||{};dat.dom=dat.dom||{};dat.color=dat.color||{};dat.utils.css=function(){return{load:function(d,b){var b=b||document,f=b.createElement("link");f.type="text/css";f.rel="stylesheet";f.href=d;b.getElementsByTagName("head")[0].appendChild(f)},inject:function(d,b){var b=b||document,f=document.createElement("style");f.type="text/css";f.innerHTML=d;b.getElementsByTagName("head")[0].appendChild(f)}}}();dat.utils.common=function(){var c=Array.prototype.forEach,b=Array.prototype.slice;return{BREAK:{},extend:function(a){this.each(b.call(arguments,1),function(d){for(var e in d){this.isUndefined(d[e])||(a[e]=d[e])}},this);return a},defaults:function(a){this.each(b.call(arguments,1),function(d){for(var e in d){this.isUndefined(a[e])&&(a[e]=d[e])}},this);return a},compose:function(){var a=b.call(arguments);return function(){for(var g=b.call(arguments),e=a.length-1;e>=0;e--){g=[a[e].apply(this,g)]}return g[0]}},each:function(g,i,h){if(c&&g.forEach===c){g.forEach(i,h)}else{if(g.length===g.length+0){for(var e=0,j=g.length;e<j;e++){if(e in g&&i.call(h,g[e],e)===this.BREAK){break}}}else{for(e in g){if(i.call(h,g[e],e)===this.BREAK){break}}}}},defer:function(d){setTimeout(d,0)},toArray:function(a){return a.toArray?a.toArray():b.call(a)},isUndefined:function(d){return d===void 0},isNull:function(d){return d===null},isNaN:function(d){return d!==d},isArray:Array.isArray||function(d){return d.constructor===Array},isObject:function(d){return d===Object(d)},isNumber:function(d){return d===d+0},isString:function(d){return d===d+""},isBoolean:function(d){return d===false||d===true},isFunction:function(d){return Object.prototype.toString.call(d)==="[object Function]"}}}();dat.controllers.Controller=function(c){var b=function(e,f){this.initialValue=e[f];this.domElement=document.createElement("div");this.object=e;this.property=f;this.__onFinishChange=this.__onChange=void 0};c.extend(b.prototype,{onChange:function(d){this.__onChange=d;return this},onFinishChange:function(d){this.__onFinishChange=d;return this},setValue:function(d){this.object[this.property]=d;this.__onChange&&this.__onChange.call(this,d);this.updateDisplay();return this},getValue:function(){return this.object[this.property]},updateDisplay:function(){return this},isModified:function(){return this.initialValue!==this.getValue()}});return b}(dat.utils.common);dat.dom.dom=function(h){function b(a){if(a==="0"||h.isUndefined(a)){return 0}a=a.match(i);return !h.isNull(a)?parseFloat(a[1]):0}var j={};h.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(c,d){h.each(c,function(a){j[a]=d})});var i=/(\d+(\.\d+)?)px/,g={makeSelectable:function(c,d){if(!(c===void 0||c.style===void 0)){c.onselectstart=d?function(){return false}:function(){},c.style.MozUserSelect=d?"auto":"none",c.style.KhtmlUserSelect=d?"auto":"none",c.unselectable=d?"on":"off"}},makeFullscreen:function(c,e,f){h.isUndefined(e)&&(e=true);h.isUndefined(f)&&(f=true);c.style.position="absolute";if(e){c.style.left=0,c.style.right=0}if(f){c.style.top=0,c.style.bottom=0}},fakeEvent:function(e,n,p,o){var p=p||{},c=j[n];if(!c){throw Error("Event type "+n+" not supported.")}var k=document.createEvent(c);switch(c){case"MouseEvents":k.initMouseEvent(n,p.bubbles||false,p.cancelable||true,window,p.clickCount||1,0,0,p.x||p.clientX||0,p.y||p.clientY||0,false,false,false,false,0,null);break;case"KeyboardEvents":c=k.initKeyboardEvent||k.initKeyEvent;h.defaults(p,{cancelable:true,ctrlKey:false,altKey:false,shiftKey:false,metaKey:false,keyCode:void 0,charCode:void 0});c(n,p.bubbles||false,p.cancelable,window,p.ctrlKey,p.altKey,p.shiftKey,p.metaKey,p.keyCode,p.charCode);break;default:k.initEvent(n,p.bubbles||false,p.cancelable||true)}h.defaults(k,o);e.dispatchEvent(k)},bind:function(e,f,k,l){e.addEventListener?e.addEventListener(f,k,l||false):e.attachEvent&&e.attachEvent("on"+f,k);return g},unbind:function(e,f,k,l){e.removeEventListener?e.removeEventListener(f,k,l||false):e.detachEvent&&e.detachEvent("on"+f,k);return g},addClass:function(c,e){if(c.className===void 0){c.className=e}else{if(c.className!==e){var f=c.className.split(/ +/);if(f.indexOf(e)==-1){f.push(e),c.className=f.join(" ").replace(/^\s+/,"").replace(/\s+$/,"")}}}return g},removeClass:function(e,f){if(f){if(e.className!==void 0){if(e.className===f){e.removeAttribute("class")}else{var k=e.className.split(/ +/),l=k.indexOf(f);if(l!=-1){k.splice(l,1),e.className=k.join(" ")}}}}else{e.className=void 0}return g},hasClass:function(c,e){return RegExp("(?:^|\\s+)"+e+"(?:\\s+|$)").test(c.className)||false},getWidth:function(a){a=getComputedStyle(a);return b(a["border-left-width"])+b(a["border-right-width"])+b(a["padding-left"])+b(a["padding-right"])+b(a.width)},getHeight:function(a){a=getComputedStyle(a);return b(a["border-top-width"])+b(a["border-bottom-width"])+b(a["padding-top"])+b(a["padding-bottom"])+b(a.height)},getOffset:function(c){var e={left:0,top:0};if(c.offsetParent){do{e.left+=c.offsetLeft,e.top+=c.offsetTop}while(c=c.offsetParent)}return e},isActive:function(c){return c===document.activeElement&&(c.type||c.href)}};return g}(dat.utils.common);dat.controllers.OptionController=function(f,b,h){var g=function(i,a,k){g.superclass.call(this,i,a);var d=this;this.__select=document.createElement("select");if(h.isArray(k)){var c={};h.each(k,function(e){c[e]=e});k=c}h.each(k,function(j,e){var l=document.createElement("option");l.innerHTML=e;l.setAttribute("value",j);d.__select.appendChild(l)});this.updateDisplay();b.bind(this.__select,"change",function(){d.setValue(this.options[this.selectedIndex].value)});this.domElement.appendChild(this.__select)};g.superclass=f;h.extend(g.prototype,f.prototype,{setValue:function(c){c=g.superclass.prototype.setValue.call(this,c);this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue());return c},updateDisplay:function(){this.__select.value=this.getValue();return g.superclass.prototype.updateDisplay.call(this)}});return g}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);dat.controllers.NumberController=function(d,b){var f=function(e,c,a){f.superclass.call(this,e,c);a=a||{};this.__min=a.min;this.__max=a.max;this.__step=a.step;e=this.__impliedStep=b.isUndefined(this.__step)?this.initialValue==0?1:Math.pow(10,Math.floor(Math.log(this.initialValue)/Math.LN10))/10:this.__step;e=e.toString();this.__precision=e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0};f.superclass=d;b.extend(f.prototype,d.prototype,{setValue:function(c){if(this.__min!==void 0&&c<this.__min){c=this.__min}else{if(this.__max!==void 0&&c>this.__max){c=this.__max}}this.__step!==void 0&&c%this.__step!=0&&(c=Math.round(c/this.__step)*this.__step);return f.superclass.prototype.setValue.call(this,c)},min:function(c){this.__min=c;return this},max:function(c){this.__max=c;return this},step:function(c){this.__step=c;return this}});return f}(dat.controllers.Controller,dat.utils.common);dat.controllers.NumberControllerBox=function(f,b,h){var g=function(n,c,p){function k(){var e=parseFloat(d.__input.value);h.isNaN(e)||d.setValue(e)}function i(j){var e=q-j.clientY;d.setValue(d.getValue()+e*d.__impliedStep);q=j.clientY}function a(){b.unbind(window,"mousemove",i);b.unbind(window,"mouseup",a)}this.__truncationSuspended=false;g.superclass.call(this,n,c,p);var d=this,q;this.__input=document.createElement("input");this.__input.setAttribute("type","text");b.bind(this.__input,"change",k);b.bind(this.__input,"blur",function(){k();d.__onFinishChange&&d.__onFinishChange.call(d,d.getValue())});b.bind(this.__input,"mousedown",function(e){b.bind(window,"mousemove",i);b.bind(window,"mouseup",a);q=e.clientY});b.bind(this.__input,"keydown",function(e){if(e.keyCode===13){d.__truncationSuspended=true,this.blur(),d.__truncationSuspended=false}});this.updateDisplay();this.domElement.appendChild(this.__input)};g.superclass=f;h.extend(g.prototype,f.prototype,{updateDisplay:function(){var e=this.__input,d;if(this.__truncationSuspended){d=this.getValue()}else{d=this.getValue();var i=Math.pow(10,this.__precision);d=Math.round(d*i)/i}e.value=d;return g.superclass.prototype.updateDisplay.call(this)}});return g}(dat.controllers.NumberController,dat.dom.dom,dat.utils.common);dat.controllers.NumberControllerSlider=function(j,h,l,k,i){var g=function(q,s,m,n,a){function p(e){e.preventDefault();var f=h.getOffset(b.__background),o=h.getWidth(b.__background);b.setValue(b.__min+(b.__max-b.__min)*((e.clientX-f.left)/(f.left+o-f.left)));return false}function r(){h.unbind(window,"mousemove",p);h.unbind(window,"mouseup",r);b.__onFinishChange&&b.__onFinishChange.call(b,b.getValue())}g.superclass.call(this,q,s,{min:m,max:n,step:a});var b=this;this.__background=document.createElement("div");this.__foreground=document.createElement("div");h.bind(this.__background,"mousedown",function(c){h.bind(window,"mousemove",p);h.bind(window,"mouseup",r);p(c)});h.addClass(this.__background,"slider");h.addClass(this.__foreground,"slider-fg");this.updateDisplay();this.__background.appendChild(this.__foreground);this.domElement.appendChild(this.__background)};g.superclass=j;g.useDefaultStyles=function(){l.inject(i)};k.extend(g.prototype,j.prototype,{updateDisplay:function(){this.__foreground.style.width=(this.getValue()-this.__min)/(this.__max-this.__min)*100+"%";return g.superclass.prototype.updateDisplay.call(this)}});return g}(dat.controllers.NumberController,dat.dom.dom,dat.utils.css,dat.utils.common,".slider {\n  box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);\n  height: 1em;\n  border-radius: 1em;\n  background-color: #eee;\n  padding: 0 0.5em;\n  overflow: hidden;\n}\n\n.slider-fg {\n  padding: 1px 0 2px 0;\n  background-color: #aaa;\n  height: 1em;\n  margin-left: -0.5em;\n  padding-right: 0.5em;\n  border-radius: 1em 0 0 1em;\n}\n\n.slider-fg:after {\n  display: inline-block;\n  border-radius: 1em;\n  background-color: #fff;\n  border:  1px solid #aaa;\n  content: '';\n  float: right;\n  margin-right: -1em;\n  margin-top: -1px;\n  height: 0.9em;\n  width: 0.9em;\n}");dat.controllers.FunctionController=function(f,b,h){var g=function(j,a,i){g.superclass.call(this,j,a);var d=this;this.__button=document.createElement("div");this.__button.innerHTML=i===void 0?"Fire":i;b.bind(this.__button,"click",function(c){c.preventDefault();d.fire();return false});b.addClass(this.__button,"button");this.domElement.appendChild(this.__button)};g.superclass=f;h.extend(g.prototype,f.prototype,{fire:function(){this.__onChange&&this.__onChange.call(this);this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue());this.getValue().call(this.object)}});return g}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);dat.controllers.BooleanController=function(f,b,h){var g=function(i,a){g.superclass.call(this,i,a);var d=this;this.__prev=this.getValue();this.__checkbox=document.createElement("input");this.__checkbox.setAttribute("type","checkbox");b.bind(this.__checkbox,"change",function(){d.setValue(!d.__prev)},false);this.domElement.appendChild(this.__checkbox);this.updateDisplay()};g.superclass=f;h.extend(g.prototype,f.prototype,{setValue:function(c){c=g.superclass.prototype.setValue.call(this,c);this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue());this.__prev=this.getValue();return c},updateDisplay:function(){this.getValue()===true?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=true):this.__checkbox.checked=false;return g.superclass.prototype.updateDisplay.call(this)}});return g}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);dat.color.toString=function(a){return function(b){if(b.a==1||a.isUndefined(b.a)){for(b=b.hex.toString(16);b.length<6;){b="0"+b}return"#"+b}else{return"rgba("+Math.round(b.r)+","+Math.round(b.g)+","+Math.round(b.b)+","+b.a+")"}}}(dat.utils.common);dat.color.interpret=function(h,b){var j,i,g=[{litmus:b.isString,conversions:{THREE_CHAR_HEX:{read:function(c){c=c.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return c===null?false:{space:"HEX",hex:parseInt("0x"+c[1].toString()+c[1].toString()+c[2].toString()+c[2].toString()+c[3].toString()+c[3].toString())}},write:h},SIX_CHAR_HEX:{read:function(c){c=c.match(/^#([A-F0-9]{6})$/i);return c===null?false:{space:"HEX",hex:parseInt("0x"+c[1].toString())}},write:h},CSS_RGB:{read:function(c){c=c.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return c===null?false:{space:"RGB",r:parseFloat(c[1]),g:parseFloat(c[2]),b:parseFloat(c[3])}},write:h},CSS_RGBA:{read:function(c){c=c.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/);return c===null?false:{space:"RGB",r:parseFloat(c[1]),g:parseFloat(c[2]),b:parseFloat(c[3]),a:parseFloat(c[4])}},write:h}}},{litmus:b.isNumber,conversions:{HEX:{read:function(c){return{space:"HEX",hex:c,conversionName:"HEX"}},write:function(c){return c.hex}}}},{litmus:b.isArray,conversions:{RGB_ARRAY:{read:function(c){return c.length!=3?false:{space:"RGB",r:c[0],g:c[1],b:c[2]}},write:function(c){return[c.r,c.g,c.b]}},RGBA_ARRAY:{read:function(c){return c.length!=4?false:{space:"RGB",r:c[0],g:c[1],b:c[2],a:c[3]}},write:function(c){return[c.r,c.g,c.b,c.a]}}}},{litmus:b.isObject,conversions:{RGBA_OBJ:{read:function(a){return b.isNumber(a.r)&&b.isNumber(a.g)&&b.isNumber(a.b)&&b.isNumber(a.a)?{space:"RGB",r:a.r,g:a.g,b:a.b,a:a.a}:false},write:function(c){return{r:c.r,g:c.g,b:c.b,a:c.a}}},RGB_OBJ:{read:function(a){return b.isNumber(a.r)&&b.isNumber(a.g)&&b.isNumber(a.b)?{space:"RGB",r:a.r,g:a.g,b:a.b}:false},write:function(c){return{r:c.r,g:c.g,b:c.b}}},HSVA_OBJ:{read:function(a){return b.isNumber(a.h)&&b.isNumber(a.s)&&b.isNumber(a.v)&&b.isNumber(a.a)?{space:"HSV",h:a.h,s:a.s,v:a.v,a:a.a}:false},write:function(c){return{h:c.h,s:c.s,v:c.v,a:c.a}}},HSV_OBJ:{read:function(a){return b.isNumber(a.h)&&b.isNumber(a.s)&&b.isNumber(a.v)?{space:"HSV",h:a.h,s:a.s,v:a.v}:false},write:function(c){return{h:c.h,s:c.s,v:c.v}}}}}];return function(){i=false;var a=arguments.length>1?b.toArray(arguments):arguments[0];b.each(g,function(c){if(c.litmus(a)){return b.each(c.conversions,function(k,d){j=k.read(a);if(i===false&&j!==false){return i=j,j.conversionName=d,j.conversion=k,b.BREAK}}),b.BREAK}});return i}}(dat.color.toString,dat.utils.common);dat.GUI=dat.gui.GUI=function(an,ar,ap,ao,am,aq,ae,ak,ai,af,ag,ad,M,al,aj){function aa(f,d,g,i){if(d[g]===void 0){throw Error("Object "+d+' has no property "'+g+'"')}i.color?d=new ag(d,g):(d=[d,g].concat(i.factoryArgs),d=ao.apply(f,d));if(i.before instanceof am){i.before=i.before.__li}V(f,d);al.addClass(d.domElement,"c");g=document.createElement("span");al.addClass(g,"property-name");g.innerHTML=d.property;var h=document.createElement("div");h.appendChild(g);h.appendChild(d.domElement);i=X(f,h,i.before);al.addClass(i,ah.CLASS_CONTROLLER_ROW);al.addClass(i,typeof d.getValue());ac(f,i,d);f.__controllers.push(d);return d}function X(f,e,g){var h=document.createElement("li");e&&h.appendChild(e);g?f.__ul.insertBefore(h,params.before):f.__ul.appendChild(h);f.onResize();return h}function ac(b,i,j){j.__li=i;j.__gui=b;aj.extend(j,{options:function(a){if(arguments.length>1){return j.remove(),aa(b,j.object,j.property,{before:j.__li.nextElementSibling,factoryArgs:[aj.toArray(arguments)]})}if(aj.isArray(a)||aj.isObject(a)){return j.remove(),aa(b,j.object,j.property,{before:j.__li.nextElementSibling,factoryArgs:[a]})}},name:function(c){j.__li.firstElementChild.firstElementChild.innerHTML=c;return j},listen:function(){j.__gui.listen(j);return j},remove:function(){j.__gui.remove(j);return j}});if(j instanceof ai){var h=new ak(j.object,j.property,{min:j.__min,max:j.__max,step:j.__step});aj.each(["updateDisplay","onChange","onFinishChange"],function(d){var c=j[d],e=h[d];j[d]=h[d]=function(){var f=Array.prototype.slice.call(arguments);c.apply(j,f);return e.apply(h,f)}});al.addClass(i,"has-slider");j.domElement.insertBefore(h.domElement,j.domElement.firstElementChild)}else{if(j instanceof ak){var g=function(a){return aj.isNumber(j.__min)&&aj.isNumber(j.__max)?(j.remove(),aa(b,j.object,j.property,{before:j.__li.nextElementSibling,factoryArgs:[j.__min,j.__max,j.__step]})):a};j.min=aj.compose(g,j.min);j.max=aj.compose(g,j.max)}else{if(j instanceof aq){al.bind(i,"click",function(){al.fakeEvent(j.__checkbox,"click")}),al.bind(j.__checkbox,"click",function(c){c.stopPropagation()})}else{if(j instanceof ae){al.bind(i,"click",function(){al.fakeEvent(j.__button,"click")}),al.bind(i,"mouseover",function(){al.addClass(j.__button,"hover")}),al.bind(i,"mouseout",function(){al.removeClass(j.__button,"hover")})}else{if(j instanceof ag){al.addClass(i,"color"),j.updateDisplay=aj.compose(function(c){i.style.borderLeftColor=j.__color.toString();return c},j.updateDisplay),j.updateDisplay()}}}}}j.setValue=aj.compose(function(a){b.getRoot().__preset_select&&j.isModified()&&Z(b.getRoot(),true);return a},j.setValue)}function V(g,f){var j=g.getRoot(),i=j.__rememberedObjects.indexOf(f.object);if(i!=-1){var h=j.__rememberedObjectIndecesToControllers[i];h===void 0&&(h={},j.__rememberedObjectIndecesToControllers[i]=h);h[f.property]=f;if(j.load&&j.load.remembered){j=j.load.remembered;if(j[g.preset]){j=j[g.preset]}else{if(j[P]){j=j[P]}else{return}}if(j[i]&&j[i][f.property]!==void 0){i=j[i][f.property],f.initialValue=i,f.setValue(i)}}}}function O(u){var t=u.__save_row=document.createElement("li");al.addClass(u.domElement,"has-save");u.__ul.insertBefore(t,u.__ul.firstChild);al.addClass(t,"save-row");var s=document.createElement("span");s.innerHTML="&nbsp;";al.addClass(s,"button gears");var q=document.createElement("span");q.innerHTML="Save";al.addClass(q,"button");al.addClass(q,"save");var p=document.createElement("span");p.innerHTML="New";al.addClass(p,"button");al.addClass(p,"save-as");var n=document.createElement("span");n.innerHTML="Revert";al.addClass(n,"button");al.addClass(n,"revert");var i=u.__preset_select=document.createElement("select");u.load&&u.load.remembered?aj.each(u.load.remembered,function(a,d){Y(u,d,d==u.preset)}):Y(u,P,false);al.bind(i,"change",function(){for(var a=0;a<u.__preset_select.length;a++){u.__preset_select[a].innerHTML=u.__preset_select[a].value}u.preset=this.value});t.appendChild(i);t.appendChild(s);t.appendChild(q);t.appendChild(p);t.appendChild(n);if(T){var t=document.getElementById("dg-save-locally"),j=document.getElementById("dg-local-explain");t.style.display="block";t=document.getElementById("dg-local-storage");localStorage.getItem(document.location.href+".isLocal")==="true"&&t.setAttribute("checked","checked");var g=function(){j.style.display=u.useLocalStorage?"block":"none"};g();al.bind(t,"change",function(){u.useLocalStorage=!u.useLocalStorage;g()})}var k=document.getElementById("dg-new-constructor");al.bind(k,"keydown",function(b){b.metaKey&&(b.which===67||b.keyCode==67)&&N.hide()});al.bind(s,"click",function(){k.innerHTML=JSON.stringify(u.getSaveObject(),void 0,2);N.show();k.focus();k.select()});al.bind(q,"click",function(){u.save()});al.bind(p,"click",function(){var a=prompt("Enter a new preset name.");a&&u.saveAs(a)});al.bind(n,"click",function(){u.revert()})}function L(g){function f(a){a.preventDefault();h=a.clientX;al.addClass(g.__closeButton,ah.CLASS_DRAG);al.bind(window,"mousemove",j);al.bind(window,"mouseup",i);return false}function j(a){a.preventDefault();g.width+=h-a.clientX;g.onResize();h=a.clientX;return false}function i(){al.removeClass(g.__closeButton,ah.CLASS_DRAG);al.unbind(window,"mousemove",j);al.unbind(window,"mouseup",i)}g.__resize_handle=document.createElement("div");aj.extend(g.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});var h;al.bind(g.__resize_handle,"mousedown",f);al.bind(g.__closeButton,"mousedown",f);g.domElement.insertBefore(g.__resize_handle,g.domElement.firstElementChild)}function W(d,c){d.domElement.style.width=c+"px";if(d.__save_row&&d.autoPlace){d.__save_row.style.width=c+"px"}if(d.__closeButton){d.__closeButton.style.width=c+"px"}}function H(e,d){var f={};aj.each(e.__rememberedObjects,function(c,b){var a={};aj.each(e.__rememberedObjectIndecesToControllers[b],function(g,h){a[h]=d?g.initialValue:g.getValue()});f[b]=a});return f}function Y(f,e,h){var g=document.createElement("option");g.innerHTML=e;g.value=e;f.__preset_select.appendChild(g);if(h){f.__preset_select.selectedIndex=f.__preset_select.length-1}}function Z(e,d){var f=e.__preset_select[e.__preset_select.selectedIndex];f.innerHTML=d?f.value+"*":f.value}function U(b){b.length!=0&&ad(function(){U(b)});aj.each(b,function(c){c.updateDisplay()})}an.inject(ap);var P="Default",T;try{T="localStorage" in window&&window.localStorage!==null}catch(r){T=false}var N,S=true,R,ab=false,Q=[],ah=function(i){function h(){localStorage.setItem(document.location.href+".gui",JSON.stringify(l.getSaveObject()))}function n(){var b=l.getRoot();b.width+=1;aj.defer(function(){b.width-=1})}var l=this;this.domElement=document.createElement("div");this.__ul=document.createElement("ul");this.domElement.appendChild(this.__ul);al.addClass(this.domElement,"dg");this.__folders={};this.__controllers=[];this.__rememberedObjects=[];this.__rememberedObjectIndecesToControllers=[];this.__listening=[];i=i||{};i=aj.defaults(i,{autoPlace:true,width:ah.DEFAULT_WIDTH});i=aj.defaults(i,{resizable:i.autoPlace,hideable:i.autoPlace});if(aj.isUndefined(i.load)){i.load={preset:P}}else{if(i.preset){i.load.preset=i.preset}}aj.isUndefined(i.parent)&&i.hideable&&Q.push(this);i.resizable=aj.isUndefined(i.parent)&&i.resizable;if(i.autoPlace&&aj.isUndefined(i.scrollable)){i.scrollable=true}var k=T&&localStorage.getItem(document.location.href+".isLocal")==="true";Object.defineProperties(this,{parent:{get:function(){return i.parent}},scrollable:{get:function(){return i.scrollable}},autoPlace:{get:function(){return i.autoPlace}},preset:{get:function(){return l.parent?l.getRoot().preset:i.load.preset},set:function(a){l.parent?l.getRoot().preset=a:i.load.preset=a;for(a=0;a<this.__preset_select.length;a++){if(this.__preset_select[a].value==this.preset){this.__preset_select.selectedIndex=a}}l.revert()}},width:{get:function(){return i.width},set:function(a){i.width=a;W(l,a)}},name:{get:function(){return i.name},set:function(a){i.name=a;if(g){g.innerHTML=i.name}}},closed:{get:function(){return i.closed},set:function(a){i.closed=a;i.closed?al.addClass(l.__ul,ah.CLASS_CLOSED):al.removeClass(l.__ul,ah.CLASS_CLOSED);this.onResize();if(l.__closeButton){l.__closeButton.innerHTML=a?ah.TEXT_OPEN:ah.TEXT_CLOSED}}},load:{get:function(){return i.load}},useLocalStorage:{get:function(){return k},set:function(b){T&&((k=b)?al.bind(window,"unload",h):al.unbind(window,"unload",h),localStorage.setItem(document.location.href+".isLocal",b))}}});if(aj.isUndefined(i.parent)){i.closed=false;al.addClass(this.domElement,ah.CLASS_MAIN);al.makeSelectable(this.domElement,false);if(T&&k){l.useLocalStorage=true;var j=localStorage.getItem(document.location.href+".gui");if(j){i.load=JSON.parse(j)}}this.__closeButton=document.createElement("div");this.__closeButton.innerHTML=ah.TEXT_CLOSED;al.addClass(this.__closeButton,ah.CLASS_CLOSE_BUTTON);this.domElement.appendChild(this.__closeButton);al.bind(this.__closeButton,"click",function(){l.closed=!l.closed})}else{if(i.closed===void 0){i.closed=true}var g=document.createTextNode(i.name);al.addClass(g,"controller-name");j=X(l,g);al.addClass(this.__ul,ah.CLASS_CLOSED);al.addClass(j,"title");al.bind(j,"click",function(b){b.preventDefault();l.closed=!l.closed;return false});if(!i.closed){this.closed=false}}i.autoPlace&&(aj.isUndefined(i.parent)&&(S&&(R=document.createElement("div"),al.addClass(R,"dg"),al.addClass(R,ah.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(R),S=false),R.appendChild(this.domElement),al.addClass(this.domElement,ah.CLASS_AUTO_PLACE)),this.parent||W(l,i.width));al.bind(window,"resize",function(){l.onResize()});al.bind(this.__ul,"webkitTransitionEnd",function(){l.onResize()});al.bind(this.__ul,"transitionend",function(){l.onResize()});al.bind(this.__ul,"oTransitionEnd",function(){l.onResize()});this.onResize();i.resizable&&L(this);l.getRoot();i.parent||n()};ah.toggleHide=function(){ab=!ab;aj.each(Q,function(b){b.domElement.style.zIndex=ab?-999:999;b.domElement.style.opacity=ab?0:1})};ah.CLASS_AUTO_PLACE="a";ah.CLASS_AUTO_PLACE_CONTAINER="ac";ah.CLASS_MAIN="main";ah.CLASS_CONTROLLER_ROW="cr";ah.CLASS_TOO_TALL="taller-than-window";ah.CLASS_CLOSED="closed";ah.CLASS_CLOSE_BUTTON="close-button";ah.CLASS_DRAG="drag";ah.DEFAULT_WIDTH=245;ah.TEXT_CLOSED="Close Controls";ah.TEXT_OPEN="Open Controls";al.bind(window,"keydown",function(b){document.activeElement.type!=="text"&&(b.which===72||b.keyCode==72)&&ah.toggleHide()},false);aj.extend(ah.prototype,{add:function(d,c){return aa(this,d,c,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(d,c){return aa(this,d,c,{color:true})},remove:function(d){this.__ul.removeChild(d.__li);this.__controllers.slice(this.__controllers.indexOf(d),1);var c=this;aj.defer(function(){c.onResize()})},destroy:function(){this.autoPlace&&R.removeChild(this.domElement)},addFolder:function(d){if(this.__folders[d]!==void 0){throw Error('You already have a folder in this GUI by the name "'+d+'"')}var c={name:d,parent:this};c.autoPlace=this.autoPlace;if(this.load&&this.load.folders&&this.load.folders[d]){c.closed=this.load.folders[d].closed,c.load=this.load.folders[d]}c=new ah(c);this.__folders[d]=c;d=X(this,c.domElement);al.addClass(d,"folder");return c},open:function(){this.closed=false},close:function(){this.closed=true},onResize:function(){var e=this.getRoot();if(e.scrollable){var d=al.getOffset(e.__ul).top,f=0;aj.each(e.__ul.childNodes,function(a){e.autoPlace&&a===e.__save_row||(f+=al.getHeight(a))});window.innerHeight-d-20<f?(al.addClass(e.domElement,ah.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-d-20+"px"):(al.removeClass(e.domElement,ah.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&aj.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"});if(e.__closeButton){e.__closeButton.style.width=e.width+"px"}},remember:function(){if(aj.isUndefined(N)){N=new M,N.domElement.innerHTML=ar}if(this.parent){throw Error("You can only call remember on a top level GUI.")}var a=this;aj.each(Array.prototype.slice.call(arguments),function(b){a.__rememberedObjects.length==0&&O(a);a.__rememberedObjects.indexOf(b)==-1&&a.__rememberedObjects.push(b)});this.autoPlace&&W(this,this.width)},getRoot:function(){for(var b=this;b.parent;){b=b.parent}return b},getSaveObject:function(){var b=this.load;b.closed=this.closed;if(this.__rememberedObjects.length>0){b.preset=this.preset;if(!b.remembered){b.remembered={}}b.remembered[this.preset]=H(this)}b.folders={};aj.each(this.__folders,function(a,d){b.folders[d]=a.getSaveObject()});return b},save:function(){if(!this.load.remembered){this.load.remembered={}}this.load.remembered[this.preset]=H(this);Z(this,false)},saveAs:function(b){if(!this.load.remembered){this.load.remembered={},this.load.remembered[P]=H(this,true)}this.load.remembered[b]=H(this);this.preset=b;Y(this,b,true)},revert:function(b){aj.each(this.__controllers,function(a){this.getRoot().load.remembered?V(b||this.getRoot(),a):a.setValue(a.initialValue)},this);aj.each(this.__folders,function(c){c.revert(c)});b||Z(this.getRoot(),false)},listen:function(d){var c=this.__listening.length==0;this.__listening.push(d);c&&U(this.__listening)}});return ah}(dat.utils.css,'<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n      \n    </div>\n    \n  </div>\n\n</div>',".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear;border:0;position:absolute;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-x:hidden}.dg.a.has-save ul{margin-top:27px}.dg.a.has-save ul.closed{margin-top:0}.dg.a .save-row{position:fixed;top:0;z-index:1002}.dg li{-webkit-transition:height 0.1s ease-out;-o-transition:height 0.1s ease-out;-moz-transition:height 0.1s ease-out;transition:height 0.1s ease-out}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;overflow:hidden;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li > *{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:9px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2fa1d6}.dg .cr.number input[type=text]{color:#2fa1d6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2fa1d6}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n",dat.controllers.factory=function(j,h,m,k,i,g,l){return function(d,c,a,b){var e=d[c];if(l.isArray(a)||l.isObject(a)){return new j(d,c,a)}if(l.isNumber(e)){return l.isNumber(a)&&l.isNumber(b)?new m(d,c,a,b):new h(d,c,{min:a,max:b})}if(l.isString(e)){return new k(d,c)}if(l.isFunction(e)){return new i(d,c,"")}if(l.isBoolean(e)){return new g(d,c)}}}(dat.controllers.OptionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.StringController=function(f,b,h){var g=function(j,a){function i(){d.setValue(d.__input.value)}g.superclass.call(this,j,a);var d=this;this.__input=document.createElement("input");this.__input.setAttribute("type","text");b.bind(this.__input,"keyup",i);b.bind(this.__input,"change",i);b.bind(this.__input,"blur",function(){d.__onFinishChange&&d.__onFinishChange.call(d,d.getValue())});b.bind(this.__input,"keydown",function(c){c.keyCode===13&&this.blur()});this.updateDisplay();this.domElement.appendChild(this.__input)};g.superclass=f;h.extend(g.prototype,f.prototype,{updateDisplay:function(){if(!b.isActive(this.__input)){this.__input.value=this.getValue()}return g.superclass.prototype.updateDisplay.call(this)}});return g}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.controllers.FunctionController,dat.controllers.BooleanController,dat.utils.common),dat.controllers.Controller,dat.controllers.BooleanController,dat.controllers.FunctionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.OptionController,dat.controllers.ColorController=function(m,r,p,o,l){function q(f,e,j,h){f.style.background="";l.each(i,function(a){f.style.cssText+="background: "+a+"linear-gradient("+e+", "+j+" 0%, "+h+" 100%); "})}function g(b){b.style.background="";b.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);";b.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";b.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";b.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";b.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var k=function(u,d){function c(e){a(e);r.bind(window,"mousemove",a);r.bind(window,"mouseup",f)}function f(){r.unbind(window,"mousemove",a);r.unbind(window,"mouseup",f)}function n(){var e=o(this.value);e!==false?(b.__color.__state=e,b.setValue(b.__color.toOriginal())):this.value=b.__color.toString()}function h(){r.unbind(window,"mousemove",w);r.unbind(window,"mouseup",h)}function a(j){j.preventDefault();var x=r.getWidth(b.__saturation_field),t=r.getOffset(b.__saturation_field),s=(j.clientX-t.left+document.body.scrollLeft)/x,j=1-(j.clientY-t.top+document.body.scrollTop)/x;j>1?j=1:j<0&&(j=0);s>1?s=1:s<0&&(s=0);b.__color.v=j;b.__color.s=s;b.setValue(b.__color.toOriginal());return false}function w(e){e.preventDefault();var s=r.getHeight(b.__hue_field),j=r.getOffset(b.__hue_field),e=1-(e.clientY-j.top+document.body.scrollTop)/s;e>1?e=1:e<0&&(e=0);b.__color.h=e*360;b.setValue(b.__color.toOriginal());return false}k.superclass.call(this,u,d);this.__color=new p(this.getValue());this.__temp=new p(0);var b=this;this.domElement=document.createElement("div");r.makeSelectable(this.domElement,false);this.__selector=document.createElement("div");this.__selector.className="selector";this.__saturation_field=document.createElement("div");this.__saturation_field.className="saturation-field";this.__field_knob=document.createElement("div");this.__field_knob.className="field-knob";this.__field_knob_border="2px solid ";this.__hue_knob=document.createElement("div");this.__hue_knob.className="hue-knob";this.__hue_field=document.createElement("div");this.__hue_field.className="hue-field";this.__input=document.createElement("input");this.__input.type="text";this.__input_textShadow="0 1px 1px ";r.bind(this.__input,"keydown",function(e){e.keyCode===13&&n.call(this)});r.bind(this.__input,"blur",n);r.bind(this.__selector,"mousedown",function(){r.addClass(this,"drag").bind(window,"mouseup",function(){r.removeClass(b.__selector,"drag")})});var v=document.createElement("div");l.extend(this.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"});l.extend(this.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:this.__field_knob_border+(this.__color.v<0.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1});l.extend(this.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1});l.extend(this.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"});l.extend(v.style,{width:"100%",height:"100%",background:"none"});q(v,"top","rgba(0,0,0,0)","#000");l.extend(this.__hue_field.style,{width:"15px",height:"100px",display:"inline-block",border:"1px solid #555",cursor:"ns-resize"});g(this.__hue_field);l.extend(this.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:this.__input_textShadow+"rgba(0,0,0,0.7)"});r.bind(this.__saturation_field,"mousedown",c);r.bind(this.__field_knob,"mousedown",c);r.bind(this.__hue_field,"mousedown",function(e){w(e);r.bind(window,"mousemove",w);r.bind(window,"mouseup",h)});this.__saturation_field.appendChild(v);this.__selector.appendChild(this.__field_knob);this.__selector.appendChild(this.__saturation_field);this.__selector.appendChild(this.__hue_field);this.__hue_field.appendChild(this.__hue_knob);this.domElement.appendChild(this.__input);this.domElement.appendChild(this.__selector);this.updateDisplay()};k.superclass=m;l.extend(k.prototype,m.prototype,{updateDisplay:function(){var b=o(this.getValue());if(b!==false){var f=false;l.each(p.COMPONENTS,function(a){if(!l.isUndefined(b[a])&&!l.isUndefined(this.__color.__state[a])&&b[a]!==this.__color.__state[a]){return f=true,{}}},this);f&&l.extend(this.__color.__state,b)}l.extend(this.__temp.__state,this.__color.__state);this.__temp.a=1;var d=this.__color.v<0.5||this.__color.s>0.5?255:0,c=255-d;l.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toString(),border:this.__field_knob_border+"rgb("+d+","+d+","+d+")"});this.__hue_knob.style.marginTop=(1-this.__color.h/360)*100+"px";this.__temp.s=1;this.__temp.v=1;q(this.__saturation_field,"left","#fff",this.__temp.toString());l.extend(this.__input.style,{backgroundColor:this.__input.value=this.__color.toString(),color:"rgb("+d+","+d+","+d+")",textShadow:this.__input_textShadow+"rgba("+c+","+c+","+c+",.7)"})}});var i=["-moz-","-o-","-webkit-","-ms-",""];return k}(dat.controllers.Controller,dat.dom.dom,dat.color.Color=function(m,r,p,o){function l(e,d,f){Object.defineProperty(e,d,{get:function(){if(this.__state.space==="RGB"){return this.__state[d]}g(this,d,f);return this.__state[d]},set:function(b){if(this.__state.space!=="RGB"){g(this,d,f),this.__state.space="RGB"}this.__state[d]=b}})}function q(d,c){Object.defineProperty(d,c,{get:function(){if(this.__state.space==="HSV"){return this.__state[c]}k(this);return this.__state[c]},set:function(b){if(this.__state.space!=="HSV"){k(this),this.__state.space="HSV"}this.__state[c]=b}})}function g(a,f,d){if(a.__state.space==="HEX"){a.__state[f]=r.component_from_hex(a.__state.hex,d)}else{if(a.__state.space==="HSV"){o.extend(a.__state,r.hsv_to_rgb(a.__state.h,a.__state.s,a.__state.v))}else{throw"Corrupted color state"}}}function k(a){var d=r.rgb_to_hsv(a.r,a.g,a.b);o.extend(a.__state,{s:d.s,v:d.v});if(o.isNaN(d.h)){if(o.isUndefined(a.__state.h)){a.__state.h=0}}else{a.__state.h=d.h}}var i=function(){this.__state=m.apply(this,arguments);if(this.__state===false){throw"Failed to interpret color arguments"}this.__state.a=this.__state.a||1};i.COMPONENTS="r,g,b,h,s,v,hex,a".split(",");o.extend(i.prototype,{toString:function(){return p(this)},toOriginal:function(){return this.__state.conversion.write(this)}});l(i.prototype,"r",2);l(i.prototype,"g",1);l(i.prototype,"b",0);q(i.prototype,"h");q(i.prototype,"s");q(i.prototype,"v");Object.defineProperty(i.prototype,"a",{get:function(){return this.__state.a},set:function(b){this.__state.a=b}});Object.defineProperty(i.prototype,"hex",{get:function(){if(!this.__state.space!=="HEX"){this.__state.hex=r.rgb_to_hex(this.r,this.g,this.b)}return this.__state.hex},set:function(b){this.__state.space="HEX";this.__state.hex=b}});return i}(dat.color.interpret,dat.color.math=function(){var a;return{hsv_to_rgb:function(g,k,i){var h=g/60-Math.floor(g/60),f=i*(1-k),j=i*(1-h*k),k=i*(1-(1-h)*k),g=[[i,k,f],[j,i,f],[f,i,k],[f,j,i],[k,f,i],[i,f,j]][Math.floor(g/60)%6];return{r:g[0]*255,g:g[1]*255,b:g[2]*255}},rgb_to_hsv:function(g,j,i){var h=Math.min(g,j,i),f=Math.max(g,j,i),h=f-h;if(f==0){return{h:NaN,s:0,v:0}}g=g==f?(j-i)/h:j==f?2+(i-g)/h:4+(g-j)/h;g/=6;g<0&&(g+=1);return{h:g*360,s:h/f,v:f/255}},rgb_to_hex:function(b,f,e){b=this.hex_with_component(0,2,b);b=this.hex_with_component(b,1,f);return b=this.hex_with_component(b,0,e)},component_from_hex:function(b,d){return b>>d*8&255},hex_with_component:function(b,f,e){return e<<(a=f*8)|b&~(255<<a)}}}(),dat.color.toString,dat.utils.common),dat.color.interpret,dat.utils.common),dat.utils.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1000/60)}}(),dat.dom.CenteredDiv=function(d,b){var f=function(){this.backgroundElement=document.createElement("div");b.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear"});d.makeFullscreen(this.backgroundElement);this.backgroundElement.style.position="fixed";this.domElement=document.createElement("div");b.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear"});document.body.appendChild(this.backgroundElement);document.body.appendChild(this.domElement);var a=this;d.bind(this.backgroundElement,"click",function(){a.hide()})};f.prototype.show=function(){var a=this;this.backgroundElement.style.display="block";this.domElement.style.display="block";this.domElement.style.opacity=0;this.domElement.style.webkitTransform="scale(1.1)";this.layout();b.defer(function(){a.backgroundElement.style.opacity=1;a.domElement.style.opacity=1;a.domElement.style.webkitTransform="scale(1)"})};f.prototype.hide=function(){var e=this,g=function(){e.domElement.style.display="none";e.backgroundElement.style.display="none";d.unbind(e.domElement,"webkitTransitionEnd",g);d.unbind(e.domElement,"transitionend",g);d.unbind(e.domElement,"oTransitionEnd",g)};d.bind(this.domElement,"webkitTransitionEnd",g);d.bind(this.domElement,"transitionend",g);d.bind(this.domElement,"oTransitionEnd",g);this.backgroundElement.style.opacity=0;this.domElement.style.opacity=0;this.domElement.style.webkitTransform="scale(1.1)"};f.prototype.layout=function(){this.domElement.style.left=window.innerWidth/2-d.getWidth(this.domElement)/2+"px";this.domElement.style.top=window.innerHeight/2-d.getHeight(this.domElement)/2+"px"};return f}(dat.dom.dom,dat.utils.common),dat.dom.dom,dat.utils.common);var Stats=function(){var B=Date.now(),A=B,G=0,z=Infinity,y=0,F=0,x=Infinity,w=0,v=0,u=0,H=document.createElement("div");H.id="stats";H.addEventListener("mousedown",function(a){a.preventDefault();b(++u%2)},!1);H.style.cssText="width:80px;opacity:0.9;cursor:pointer";var L=document.createElement("div");L.id="fps";L.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002";H.appendChild(L);var E=document.createElement("div");E.id="fpsText";E.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px";E.innerHTML="FPS";L.appendChild(E);var K=document.createElement("div");K.id="fpsGraph";K.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff";for(L.appendChild(K);74>K.children.length;){var D=document.createElement("span");D.style.cssText="width:1px;height:30px;float:left;background-color:#113";K.appendChild(D)}var J=document.createElement("div");J.id="ms";J.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none";H.appendChild(J);var C=document.createElement("div");C.id="msText";C.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px";C.innerHTML="MS";J.appendChild(C);var I=document.createElement("div");I.id="msGraph";I.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0";for(J.appendChild(I);74>I.children.length;){D=document.createElement("span"),D.style.cssText="width:1px;height:30px;float:left;background-color:#131",I.appendChild(D)}var b=function(a){u=a;switch(u){case 0:L.style.display="block";J.style.display="none";break;case 1:L.style.display="none",J.style.display="block"}};return{REVISION:11,domElement:H,setMode:b,begin:function(){B=Date.now()},end:function(){var c=Date.now();G=c-B;z=Math.min(z,G);y=Math.max(y,G);C.textContent=G+" MS ("+z+"-"+y+")";var d=Math.min(30,30-30*(G/200));I.appendChild(I.firstChild).style.height=d+"px";v++;c>A+1000&&(F=Math.round(1000*v/(c-A)),x=Math.min(x,F),w=Math.max(w,F),E.textContent=F+" FPS ("+x+"-"+w+")",d=Math.min(30,30-30*(F/100)),K.appendChild(K.firstChild).style.height=d+"px",A=c,v=0);return c},update:function(){B=this.end()}}};